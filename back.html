<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Klondike Solitaire Deluxe</title>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js"></script>
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --board-bg: #006400;
Â  Â  Â  Â  Â  Â  --card-bg: #f8f8f8;
Â  Â  Â  Â  Â  Â  --card-border: #333333;
Â  Â  Â  Â  Â  Â  --card-placeholder: rgba(255, 255, 255, 0.2);
Â  Â  Â  Â  Â  Â  --card-width: 100px;
Â  Â  Â  Â  Â  Â  --card-height: 140px;
Â  Â  Â  Â  Â  Â  --gap: 15px;
Â  Â  Â  Â  Â  Â  --border-radius: 8px;
Â  Â  Â  Â  Â  Â  --xp-color: #007bff;
Â  Â  Â  Â  Â  Â  --card-overlap: 28px;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: flex-start;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  -webkit-user-select: none;
Â  Â  Â  Â  Â  Â  -ms-user-select: none;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  Â  Â  /* Style for full-screen background */
Â  Â  Â  Â  Â  Â  background-size: cover;
Â  Â  Â  Â  Â  Â  background-position: center;
Â  Â  Â  Â  Â  Â  transition: background 0.5s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #starfield-canvas, #lavalamp-canvas, #ocean-canvas, #matrix-canvas, #geometric-canvas, #fire-canvas, #rain-canvas, #hyperspace-canvas, #plasma-canvas, #forest-canvas, #neongrid-canvas, #sakura-canvas, #quantum-canvas, #digitalrain-canvas, #sands-canvas, #inkblot-canvas, #cosmic-canvas, #musicviz-canvas, #bioforest-canvas, #stainedglass-canvas, #watery-canvas, #swarm-canvas, #glitch-canvas, #aurora-canvas, #constellation-canvas, #synthwave-canvas, #nebula-canvas, #jungle-canvas, #cityscape-canvas, #paint-canvas, #laserGrid-canvas, #neonPalms-canvas, #memphis-canvas, #cassette-canvas, #eightBitCity-canvas {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  z-index: -1;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  #starfield-canvas, #matrix-canvas, #hyperspace-canvas, #neongrid-canvas, #digitalrain-canvas, #cosmic-canvas, #swarm-canvas, #glitch-canvas, #constellation-canvas, #synthwave-canvas, #nebula-canvas, #laserGrid-canvas, #neonPalms-canvas, #eightBitCity-canvas, #cityscape-canvas, #cassette-canvas { background-color: #000; }
Â  Â  Â  Â  #plasma-canvas, #forest-canvas, #quantum-canvas, #bioforest-canvas, #aurora-canvas, #jungle-canvas { background-color: #111; }


Â  Â  Â  Â  /* Title Screen */
Â  Â  Â  Â  #title-screen {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: var(--board-bg);
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  Â  Â  transition: opacity 0.5s ease-out, visibility 0.5s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #title-screen.hidden {
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  visibility: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  #title-screen h1 {
Â  Â  Â  Â  Â  Â  font-size: clamp(2rem, 5vw, 4rem);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  text-shadow: 3px 3px 5px rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  animation: float 5s ease-in-out infinite;
Â  Â  Â  Â  }
Â  Â  Â  Â  #title-screen button {
Â  Â  Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border-radius: var(--border-radius);
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  background-color: #4CAF50;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  animation: float 5s ease-in-out 0.5s infinite;
Â  Â  Â  Â  }
Â  Â  Â  Â  #title-screen button:hover {
Â  Â  Â  Â  Â  Â  transform: scale(1.05);
Â  Â  Â  Â  Â  Â  background-color: #45a049;
Â  Â  Â  Â  }
Â  Â  Â  Â  .title-cards {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  perspective: 1000px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .title-card {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  width: var(--card-width);
Â  Â  Â  Â  Â  Â  height: var(--card-height);
Â  Â  Â  Â  Â  Â  transform-style: preserve-3d;
Â  Â  Â  Â  Â  Â  transition: transform 1s;
Â  Â  Â  Â  Â  Â  animation: fanOut 2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
Â  Â  Â  Â  }
Â  Â  Â  Â  .title-card-inner {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  transform-style: preserve-3d;
Â  Â  Â  Â  Â  Â  animation: flip 2s ease-in-out forwards;
Â  Â  Â  Â  Â  Â  animation-delay: calc(var(--i) * 0.2s + 1s);
Â  Â  Â  Â  }
Â  Â  Â  Â  .title-card-front, .title-card-back {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  backface-visibility: hidden;
Â  Â  Â  Â  Â  Â  border-radius: var(--border-radius);
Â  Â  Â  Â  }
Â  Â  Â  Â  .title-card-front {
Â  Â  Â  Â  Â  Â  background: var(--card-bg);
Â  Â  Â  Â  Â  Â  border: 1px solid black;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  font-size: 40px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .title-card-back {
Â  Â  Â  Â  Â  Â  background: linear-gradient(45deg, #005A9C, #003D6B);
Â  Â  Â  Â  Â  Â  border: 5px solid white;
Â  Â  Â  Â  Â  Â  transform: rotateY(180deg);
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes fanOut {
Â  Â  Â  Â  Â  Â  from { transform: translate(-50%, -50%) rotate(0deg) scale(0); }
Â  Â  Â  Â  Â  Â  to { transform: translate(-50%, -50%) rotate(var(--rot)) translateY(-150px) scale(1); }
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes flip {
Â  Â  Â  Â  Â  Â  from { transform: rotateY(180deg); }
Â  Â  Â  Â  Â  Â  to { transform: rotateY(0deg); }
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes float {
Â  Â  Â  Â  Â  Â  0%, 100% { transform: translateY(0); }
Â  Â  Â  Â  Â  Â  50% { transform: translateY(-10px); }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Main Game Layout */
Â  Â  Â  Â  #game-container {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #top-bar {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  padding: 5px;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.2);
Â  Â  Â  Â  Â  Â  border-radius: var(--border-radius);
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  #combo-canvas {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  z-index: 50;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #player-stats-panel {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: row;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .game-controls {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: row;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #xp-container {Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #xp-bar-container {
Â  Â  Â  Â  Â  Â  width: 80px;
Â  Â  Â  Â  Â  Â  height: 15px;
Â  Â  Â  Â  Â  Â  background-color: #e9ecef;
Â  Â  Â  Â  Â  Â  border-radius: var(--border-radius);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: row;
Â  Â  Â  Â  }
Â  Â  Â  Â  #xp-bar {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  width: 0%;
Â  Â  Â  Â  Â  Â  background-color: var(--xp-color);
Â  Â  Â  Â  Â  Â  transition: width 0.5s ease-in-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  #level-text, #xp-text, #game-timer, #achievement-score-display {Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
Â  Â  Â  Â  }
Â  Â  Â  Â  #xp-text { font-size: 0.7em; }

Â  Â  Â  Â  .game-controls button, #options-btn, #fullscreen-btn, #mute-btn {
Â  Â  Â  Â  Â  Â  padding: 4px 8px;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border-radius: var(--border-radius);
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  background-color: #4CAF50;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  #options-btn, #fullscreen-btn, #mute-btn { background-color: #6c757d; font-size: 14px; }
Â  Â  Â  Â  #options-btn:hover, #fullscreen-btn:hover, #mute-btn:hover { background-color: #5a6268; }
Â  Â  Â  Â  #hint-btn { background-color: #ffc107; color: black; }
Â  Â  Â  Â  #hint-btn:hover { background-color: #e0a800; }
Â  Â  Â  Â  #hint-btn:disabled, #undo-btn:disabled { background-color: #6c757d; cursor: not-allowed; }
Â  Â  Â  Â  #undo-btn { background-color: #17a2b8; }
Â  Â  Â  Â  #undo-btn:hover { background-color: #138496; }
Â  Â  Â  Â  #autocomplete-btn { background-color: #007bff; }
Â  Â  Â  Â  #autocomplete-btn:hover { background-color: #0069d9; }
Â  Â  Â  Â  #autocomplete-btn.hidden { display: none; }
Â  Â  Â  Â  #fullscreen-btn svg, #mute-btn svg {
Â  Â  Â  Â  Â  Â  width: 14px;
Â  Â  Â  Â  Â  Â  height: 14px;
Â  Â  Â  Â  Â  Â  fill: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  #message-box { font-size: 18px; font-weight: bold; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.7); min-height: 25px; width: 100%; text-align: center; margin-bottom: 10px; }

Â  Â  Â  Â  #game-board-container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  #game-board {Â 
Â  Â  Â  Â  Â  Â  display: grid;Â 
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(7, var(--card-width));Â 
Â  Â  Â  Â  Â  Â  gap: var(--gap);Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 80, 0, 0.6);Â 
Â  Â  Â  Â  Â  Â  padding: var(--gap);Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--border-radius);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 20px rgba(0,0,0,0.2);Â 
Â  Â  Â  Â  Â  Â  width: fit-content;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .upper-area { grid-column: 1 / 8; display: flex; justify-content: space-between; margin-bottom: var(--gap); }
Â  Â  Â  Â  .stock-waste-area, .foundation-area { display: flex; gap: var(--gap); }
Â  Â  Â  Â  .pile, .card { width: var(--card-width); height: var(--card-height); border-radius: var(--border-radius); box-sizing: border-box; }
Â  Â  Â  Â  .pile { border: 2px dashed var(--card-placeholder); position: relative; display: flex; justify-content: center; align-items: center; }
Â  Â  Â  Â  .pile.stock::before { content: 'â™»ï¸'; font-size: 40px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.5; }

Â  Â  Â  Â  .card { position: absolute; cursor: grab; background-color: var(--card-bg); border: 1px solid var(--card-border); display: flex; flex-direction: column; justify-content: space-between; padding: 5px; font-weight: bold; user-select: none; transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
Â  Â  Â  Â  .card.red { color: #d90429; }
Â  Â  Â  Â  .card.black { color: #000000; }
Â  Â  Â  Â  .tableau-pile { position: relative; width: var(--card-width); min-height: var(--card-height); }
Â  Â  Â  Â  .tableau-pile .card { position: absolute; top: 0; left: 0; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card .card-value { padding: 5px; font-size: clamp(14px, calc(var(--card-width) * 0.28), 28px); line-height: 1; }
Â  Â  Â  Â  .card .card-value.bottom { align-self: flex-end; transform: rotate(180deg); }
Â  Â  Â  Â  .card .card-center-suit { display: none; }
Â  Â  Â  Â  [data-face-style="easy-see"] .card.is-top-card .card-value { display: none; }
Â  Â  Â  Â  [data-face-style="easy-see"] .card.is-top-card .card-center-suit { display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; font-size: clamp(60px, calc(var(--card-width) * 1.2), 120px); line-height: 1; position: relative; }
Â  Â  Â  Â  [data-face-style="easy-see"] .card.is-top-card .card-center-value { position: absolute; font-size: clamp(24px, calc(var(--card-width) * 0.48), 48px); color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }

Â  Â  Â  Â  .card.face-down { color: transparent; border: 5px solid white; background-size: cover; background-position: center; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #fireworks-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
Â  Â  Â  Â  .firework { position: absolute; font-size: 40px; opacity: 0; animation: shootUp 1s ease-out forwards; }
Â  Â  Â  Â  @keyframes shootUp { to { transform: translateY(-80vh); opacity: 1; } }
Â  Â  Â  Â  .card.win-animate { display: none; }
Â  Â  Â  Â  .hint-glow { animation: glow 1.5s infinite; }
Â  Â  Â  Â  @keyframes glow { 50% { box-shadow: 0 0 20px 10px #ffc107; } }

Â  Â  Â  Â  /* Modals */
Â  Â  Â  Â  .modal-overlay { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
Â  Â  Â  Â  .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 800px; border-radius: var(--border-radius); max-height: 80vh; overflow-y: auto; position: relative; }
Â  Â  Â  Â  .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
Â  Â  Â  Â  .options-section { margin-top: 20px; }
Â  Â  Â  Â  .options-section h4 { margin-bottom: 10px; }
Â  Â  Â  Â  .options-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; margin-top: 10px; }
Â  Â  Â  Â  .options-grid-item { width: 100px; height: 140px; border-radius: var(--border-radius); cursor: pointer; position: relative; background-size: cover; background-position: center; border: 2px solid transparent; }
Â  Â  Â  Â  .options-grid-item.locked::after { content: 'ğŸ”’'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 40px; color: white; background: rgba(0,0,0,0.5); width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; border-radius: var(--border-radius); }
Â  Â  Â  Â  .options-grid-item.selected { box-shadow: 0 0 0 4px #007bff; border-color: #007bff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #unlock-modal .modal-content, #draw-select-modal .modal-content, #card-style-modal .modal-content, #reset-confirm-modal .modal-content { max-width: 500px; text-align: center; }
Â  Â  Â  Â  #unlock-modal h2, #draw-select-modal h2, #card-style-modal h2, #reset-confirm-modal h2 { font-size: 2em; color: var(--xp-color); }
Â  Â  Â  Â  #reset-confirm-modal h2 { color: #d90429; }
Â  Â  Â  Â  #unlock-modal p, #draw-select-modal p, #card-style-modal p, #reset-confirm-modal p { font-size: 1.2em; margin: 20px 0; }
Â  Â  Â  Â  #unlock-modal button, #reset-confirm-modal button { padding: 10px 30px; font-size: 1.2em; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .modal-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
Â  Â  Â  Â  .modal-buttons button { padding: 10px 30px; font-size: 1.2em; cursor: pointer; border-radius: var(--border-radius); border: none; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
Â  Â  Â  Â  #draw-1-btn, #normal-style-btn, #unlock-apply-btn { background-color: #007bff; }
Â  Â  Â  Â  #draw-3-btn, #easy-see-btn { background-color: #4CAF50; }
Â  Â  Â  Â  #unlock-close-btn, #reset-cancel-btn { background-color: #6c757d; }
Â  Â  Â  Â  #reset-confirm-btn { background-color: #d90429; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #achievement-modal .modal-content { max-width: 600px; }
Â  Â  Â  Â  .achievement-entry { display: flex; align-items: center; margin-bottom: 10px; opacity: 0.5; }
Â  Â  Â  Â  .achievement-entry.unlocked { opacity: 1; }
Â  Â  Â  Â  .achievement-entry-icon { font-size: 30px; margin-right: 15px; }
Â  Â  Â  Â  .achievement-entry-details h4 { margin: 0; }
Â  Â  Â  Â  .achievement-entry-details p { margin: 0; font-size: 0.9em; color: #6c757d; }

Â  Â  Â  Â  #achievement-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column-reverse; gap: 10px; pointer-events: none; }
Â  Â  Â  Â  .achievement-toast { display: flex; align-items: center; background: rgba(0, 0, 0, 0.8); color: white; padding: 10px 20px; border-radius: 50px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); transform: translateY(150%); opacity: 0; animation: slide-in-out 5s forwards; }
Â  Â  Â  Â  .achievement-icon { font-size: 30px; margin-right: 15px; }
Â  Â  Â  Â  .achievement-details h4 { margin: 0; font-size: 1em; color: #10e010; }
Â  Â  Â  Â  .achievement-details p { margin: 0; font-size: 0.8em; }
Â  Â  Â  Â  @keyframes slide-in-out { 0% { transform: translateY(150%); opacity: 0; } 10% { transform: translateY(0); opacity: 1; } 90% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(150%); opacity: 0; } }

Â  Â  Â  Â  footer { margin-top: 20px; color: #6c757d; font-size: 14px; }

Â  Â  Â  Â  #flash-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.8);
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  z-index: 9998;
Â  Â  Â  Â  }

Â  Â  Â  Â  #flash-overlay.flash {
Â  Â  Â  Â  Â  Â  animation: white-flash 0.3s ease-out;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes white-flash {
Â  Â  Â  Â  Â  Â  0% { opacity: 1; }
Â  Â  Â  Â  Â  Â  100% { opacity: 0; }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Animated Card Back Keyframes --- */
Â  Â  Â  Â  @keyframes vortex { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
Â  Â  Â  Â  @keyframes scanlines { 0% { background-position: 0 0; } 100% { background-position: 0 50px; } }
Â  Â  Â  Â  @keyframes pulse { 0%, 100% { box-shadow: inset 0 0 20px #fff; } 50% { box-shadow: inset 0 0 30px #0ff; } }
Â  Â  Â  Â  @keyframes rainbow-shift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
Â  Â  Â  Â  @keyframes liquid-metal { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
Â  Â  Â  Â  @keyframes twinkle-stars { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
Â  Â  Â  Â  @keyframes glacial-ice { 0% { background-position: 0% 0%; } 100% { background-position: 50px 50px; } }
Â  Â  Â  Â  @keyframes arcane-runes { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.8; } }
Â  Â  Â  Â  @keyframes molten-core { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
Â  Â  Â  Â  @keyframes circuitry { 0% { background-position: 0 0; } 100% { background-position: -100px 0; } }

Â  Â  Â  Â  /* --- Animated Card Back Styles --- */
Â  Â  Â  Â  [data-back-style="animated-vortex"] .face-down { background: conic-gradient(from 0.5turn at 50% 50%, #000, #2a004f, #6a0dad, #9400d3, #4b0082, #000); animation: vortex 5s linear infinite; }
Â  Â  Â  Â  [data-back-style="animated-scanlines"] .face-down { background-color: #111; background-image: linear-gradient(rgba(0, 255, 0, 0.3) 1px, transparent 1px); background-size: 100% 4px; animation: scanlines 1s linear infinite; }
Â  Â  Â  Â  [data-back-style="animated-pulse"] .face-down { background-color: #022; animation: pulse 2s ease-in-out infinite; }
Â  Â  Â  Â  [data-back-style="animated-rainbow"] .face-down { background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet, red); background-size: 200% 200%; animation: rainbow-shift 5s ease infinite; }
Â  Â  Â  Â  [data-back-style="animated-circuitry"] .face-down { background-color: #010; background-image: linear-gradient(45deg, #0f0 25%, transparent 25%, transparent 75%, #0f0 75%, #0f0), linear-gradient(-45deg, #0f0 25%, transparent 25%, transparent 75%, #0f0 75%, #0f0); background-size: 50px 50px; animation: circuitry 3s linear infinite; }
Â  Â  Â  Â  [data-back-style="animated-liquid"] .face-down { background: linear-gradient(60deg, #ccc, #fff, #999, #eee, #ccc); background-size: 400% 400%; animation: liquid-metal 4s ease infinite; }
Â  Â  Â  Â  [data-back-style="animated-stars"] .face-down { background-color: #000; background-image: radial-gradient(white 1px, transparent 1px), radial-gradient(white 1px, transparent 1px); background-size: 50px 50px, 25px 25px; background-position: 0 0, 12.5px 12.5px; animation: twinkle-stars 3s ease-in-out infinite; }
Â  Â  Â  Â  [data-back-style="animated-ice"] .face-down { background-color: #aef; background-image: linear-gradient(30deg, #fff 12%, transparent 12.5%, transparent 87%, #fff 87.5%, #fff), linear-gradient(150deg, #fff 12%, transparent 12.5%, transparent 87%, #fff 87.5%, #fff), linear-gradient(30deg, #fff 12%, transparent 12.5%, transparent 87%, #fff 87.5%, #fff), linear-gradient(150deg, #fff 12%, transparent 12.5%, transparent 87%, #fff 87.5%, #fff); background-size: 40px 70px; background-position: 0 0, 0 0, 20px 35px, 20px 35px; animation: glacial-ice 10s linear infinite; }
Â  Â  Â  Â  [data-back-style="animated-runes"] .face-down { background-color: #2c003e; color: #ff00ff; text-align: center; font-size: 40px; line-height: 140px; font-family: 'Times New Roman', serif; animation: arcane-runes 4s ease-in-out infinite; }
Â  Â  Â  Â  [data-back-style="animated-runes"] .face-down::before { content: 'á›'; }
Â  Â  Â  Â  [data-back-style="animated-molten"] .face-down { background: linear-gradient(45deg, #ff4500, #ff8c00, #ffd700, #ff4500); background-size: 400% 400%; animation: molten-core 3s ease infinite; }

Â  Â  Â  Â  /* Responsive Layout */
Â  Â  Â  Â  @media (max-width: 640px) {
Â  Â  Â  Â  Â  Â  :root { --card-width: calc((100vw - 45px) / 7); --card-height: calc(var(--card-width) * 1.4); --gap: 5px; }
Â  Â  Â  Â  Â  Â  #top-bar { gap: 5px; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <canvas id="starfield-canvas"></canvas>
Â  Â  <canvas id="lavalamp-canvas"></canvas>
Â  Â  <canvas id="ocean-canvas"></canvas>
Â  Â  <canvas id="matrix-canvas"></canvas>
Â  Â  <canvas id="geometric-canvas"></canvas>
Â  Â  <canvas id="fire-canvas"></canvas>
Â  Â  <canvas id="rain-canvas"></canvas>
Â  Â  <canvas id="hyperspace-canvas"></canvas>
Â  Â  <canvas id="plasma-canvas"></canvas>
Â  Â  <canvas id="forest-canvas"></canvas>
Â  Â  <canvas id="neongrid-canvas"></canvas>
Â  Â  <canvas id="sakura-canvas"></canvas>
Â  Â  <canvas id="quantum-canvas"></canvas>
Â  Â  <canvas id="digitalrain-canvas"></canvas>
Â  Â  <canvas id="sands-canvas"></canvas>
Â  Â  <canvas id="inkblot-canvas"></canvas>
Â  Â  <canvas id="cosmic-canvas"></canvas>
Â  Â  <canvas id="musicviz-canvas"></canvas>
Â  Â  <canvas id="bioforest-canvas"></canvas>
Â  Â  <canvas id="stainedglass-canvas"></canvas>
Â  Â  <canvas id="watery-canvas"></canvas>
Â  Â  <canvas id="swarm-canvas"></canvas>
Â  Â  <canvas id="glitch-canvas"></canvas>
Â  Â  <canvas id="aurora-canvas"></canvas>
Â  Â  <canvas id="constellation-canvas"></canvas>
Â  Â  <canvas id="synthwave-canvas"></canvas>
Â  Â  <canvas id="nebula-canvas"></canvas>
Â  Â  <canvas id="jungle-canvas"></canvas>
Â  Â  <canvas id="cityscape-canvas"></canvas>
Â  Â  <canvas id="paint-canvas"></canvas>
Â  Â  <canvas id="laserGrid-canvas"></canvas>
Â  Â  <canvas id="neonPalms-canvas"></canvas>
Â  Â  <canvas id="memphis-canvas"></canvas>
Â  Â  <canvas id="cassette-canvas"></canvas>
Â  Â  <canvas id="eightBitCity-canvas"></canvas>
Â  Â Â 
Â  Â  <div id="flash-overlay"></div>

Â  Â  <div id="title-screen">
Â  Â  Â  Â  <div class="title-cards"></div>
Â  Â  Â  Â  <h1>Klondike Solitaire</h1>
Â  Â  Â  Â  <button id="start-game-btn">Start Game</button>
Â  Â  </div>

Â  Â  <div id="game-container">
Â  Â  Â  Â  <canvas id="combo-canvas"></canvas>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="top-bar">
Â  Â  Â  Â  Â  Â  <div id="player-stats-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="xp-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="level-text">Level 1</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="xp-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="xp-bar"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="xp-text">0/10 XP</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="achievement-score-display">ğŸ† 0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="game-timer">00:00</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="game-controls">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="new-game-btn">New Game</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="autocomplete-btn" class="hidden">Autocomplete</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="undo-btn">âŒ Undo (0)</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="hint-btn">ğŸ’¡ Hint (0)</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="achievements-btn">ğŸ†</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="options-btn">âš™ï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="fullscreen-btn">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg id="fullscreen-icon" viewBox="0 0 24 24">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg id="exit-fullscreen-icon" viewBox="0 0 24 24" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="mute-btn">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg id="unmuted-icon" viewBox="0 0 24 24">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg id="muted-icon" viewBox="0 0 24 24" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="game-board-container">
Â  Â  Â  Â  Â  Â  <div id="message-box"></div>
Â  Â  Â  Â  Â  Â  <div id="game-board">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="upper-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stock-waste-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pile stock" id="stock-pile"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pile" id="waste-pile"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="foundation-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pile" id="foundation-0"></div><div class="pile" id="foundation-1"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pile" id="foundation-2"></div><div class="pile" id="foundation-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="tableau-pile" id="tableau-0"></div><div class="tableau-pile" id="tableau-1"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="tableau-pile" id="tableau-2"></div><div class="tableau-pile" id="tableau-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="tableau-pile" id="tableau-4"></div><div class="tableau-pile" id="tableau-5"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="tableau-pile" id="tableau-6"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <footer style="margin-top: auto; padding-top: 20px;">Created by PM Lewis</footer>
Â  Â  </div>

Â  Â  <div id="draw-select-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <h2>Choose Draw Style</h2>
Â  Â  Â  Â  Â  Â  <p>Select whether to draw one or three cards from the stock pile at a time.</p>
Â  Â  Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="draw-1-btn">Draw 1</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="draw-3-btn">Draw 3</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="card-style-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <h2>Choose Card Style</h2>
Â  Â  Â  Â  Â  Â  <p>Select your preferred card face style for this game.</p>
Â  Â  Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="normal-style-btn">Normal</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="easy-see-btn">Easy See</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="options-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <span class="close-btn">&times;</span>
Â  Â  Â  Â  Â  Â  <h2>Options</h2>
Â  Â  Â  Â  Â  Â  <div class="options-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h4>Playing Boards</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <div>New backgrounds unlock with each level!</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="board-selector" class="options-grid"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="options-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h4>Card Backs</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <div>New card backs unlock with each level!</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="card-back-selector" class="options-grid"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â <div class="options-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h4>Music Tracks</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <div>New tracks unlock every other level!</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="music-selector" class="options-grid"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="options-section" style="text-align: center; margin-top: 30px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="reset-progress-btn" style="background-color: #d9534f; border-color: #d43f3a;">Reset All Progress</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="reset-confirm-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <h2>Reset Progress</h2>
Â  Â  Â  Â  Â  Â  <p>Are you sure you want to reset all of your progress? This action cannot be undone.</p>
Â  Â  Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="reset-confirm-btn">Yes, Reset</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="reset-cancel-btn">Cancel</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="unlock-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <h2 id="unlock-title"></h2>
Â  Â  Â  Â  Â  Â  <p id="unlock-description"></p>
Â  Â  Â  Â  Â  Â  <p id="unlock-prompt" style="display:none;">Would you like to apply it now?</p>
Â  Â  Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="unlock-apply-btn" style="display:none;">Yes, Apply!</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="unlock-close-btn">Awesome!</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="achievement-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <span class="close-btn">&times;</span>
Â  Â  Â  Â  Â  Â  <h2>Achievements</h2>
Â  Â  Â  Â  Â  Â  <div id="achievement-list"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="achievement-container"></div>
Â  Â  <div id="fireworks-container"></div>

Â  Â  <script>
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  // --- DOM Element Selection ---
Â  Â  Â  Â  // This section efficiently gathers all necessary HTML elements from the page
Â  Â  Â  Â  // to be used by the JavaScript game logic.
Â  Â  Â  Â  const gameBoard = document.getElementById('game-board');
Â  Â  Â  Â  const stockPileEl = document.getElementById('stock-pile');
Â  Â  Â  Â  const wastePileEl = document.getElementById('waste-pile');
Â  Â  Â  Â  const foundationEls = Array.from({ length: 4 }, (_, i) => document.getElementById(`foundation-${i}`));
Â  Â  Â  Â  const tableauEls = Array.from({ length: 7 }, (_, i) => document.getElementById(`tableau-${i}`));
Â  Â  Â  Â  const newGameBtn = document.getElementById('new-game-btn');
Â  Â  Â  Â  const autocompleteBtn = document.getElementById('autocomplete-btn');
Â  Â  Â  Â  const hintBtn = document.getElementById('hint-btn');
Â  Â  Â  Â  const undoBtn = document.getElementById('undo-btn');
Â  Â  Â  Â  const messageBox = document.getElementById('message-box');
Â  Â  Â  Â  const titleScreen = document.getElementById('title-screen');
Â  Â  Â  Â  const startGameBtn = document.getElementById('start-game-btn');
Â  Â  Â  Â  const gameContainer = document.getElementById('game-container');
Â  Â  Â  Â  const optionsBtn = document.getElementById('options-btn');
Â  Â  Â  Â  const optionsModal = document.getElementById('options-modal');
Â  Â  Â  Â  const closeModalBtn = document.querySelector('#options-modal .close-btn');
Â  Â  Â  Â  const unlockModal = document.getElementById('unlock-modal');
Â  Â  Â  Â  const unlockCloseBtn = document.getElementById('unlock-close-btn');
Â  Â  Â  Â  const unlockApplyBtn = document.getElementById('unlock-apply-btn');
Â  Â  Â  Â  const unlockPrompt = document.getElementById('unlock-prompt');
Â  Â  Â  Â  const unlockTitle = document.getElementById('unlock-title');
Â  Â  Â  Â  const unlockDescription = document.getElementById('unlock-description');
Â  Â  Â  Â  const cardBackSelector = document.getElementById('card-back-selector');
Â  Â  Â  Â  const boardSelector = document.getElementById('board-selector');
Â  Â  Â  Â  const musicSelector = document.getElementById('music-selector');
Â  Â  Â  Â  const winCountEl = document.querySelector('#options-modal #win-count');
Â  Â  Â  Â  const levelTextEl = document.getElementById('level-text');
Â  Â  Â  Â  const xpTextEl = document.getElementById('xp-text');
Â  Â  Â  Â  const xpBarEl = document.getElementById('xp-bar');
Â  Â  Â  Â  const comboCanvas = document.getElementById('combo-canvas');
Â  Â  Â  Â  const gameTimerEl = document.getElementById('game-timer');
Â  Â  Â  Â  const cardBackUnlockScoreEl = document.getElementById('card-back-unlock-score');
Â  Â  Â  Â  const boardUnlockScoreEl = document.getElementById('board-unlock-score');
Â  Â  Â  Â  const achievementContainer = document.getElementById('achievement-container');
Â  Â  Â  Â  const achievementScoreDisplay = document.getElementById('achievement-score-display');
Â  Â  Â  Â  const achievementsBtn = document.getElementById('achievements-btn');
Â  Â  Â  Â  const achievementModal = document.getElementById('achievement-modal');
Â  Â  Â  Â  const achievementListEl = document.getElementById('achievement-list');
Â  Â  Â  Â  const closeAchievementModalBtn = document.querySelector('#achievement-modal .close-btn');
Â  Â  Â  Â  const flashOverlay = document.getElementById('flash-overlay');
Â  Â  Â  Â  const drawSelectModal = document.getElementById('draw-select-modal');
Â  Â  Â  Â  const draw1Btn = document.getElementById('draw-1-btn');
Â  Â  Â  Â  const draw3Btn = document.getElementById('draw-3-btn');
Â  Â  Â  Â  const cardStyleModal = document.getElementById('card-style-modal');
Â  Â  Â  Â  const normalStyleBtn = document.getElementById('normal-style-btn');
Â  Â  Â  Â  const easySeeBtn = document.getElementById('easy-see-btn');
Â  Â  Â  Â  const fullscreenBtn = document.getElementById('fullscreen-btn');
Â  Â  Â  Â  const fullscreenIcon = document.getElementById('fullscreen-icon');
Â  Â  Â  Â  const exitFullscreenIcon = document.getElementById('exit-fullscreen-icon');
Â  Â  Â  Â  const muteBtn = document.getElementById('mute-btn');
Â  Â  Â  Â  const unmutedIcon = document.getElementById('unmuted-icon');
Â  Â  Â  Â  const mutedIcon = document.getElementById('muted-icon');
Â  Â  Â  Â  const resetProgressBtn = document.getElementById('reset-progress-btn');
Â  Â  Â  Â  const resetConfirmModal = document.getElementById('reset-confirm-modal');
Â  Â  Â  Â  const resetConfirmBtn = document.getElementById('reset-confirm-btn');
Â  Â  Â  Â  const resetCancelBtn = document.getElementById('reset-cancel-btn');
Â  Â  Â  Â  const starfieldCanvas = document.getElementById('starfield-canvas');
Â  Â  Â  Â  const lavalampCanvas = document.getElementById('lavalamp-canvas');
Â  Â  Â  Â  const oceanCanvas = document.getElementById('ocean-canvas');
Â  Â  Â  Â  const matrixCanvas = document.getElementById('matrix-canvas');
Â  Â  Â  Â  const geometricCanvas = document.getElementById('geometric-canvas');
Â  Â  Â  Â  const fireCanvas = document.getElementById('fire-canvas');
Â  Â  Â  Â  const rainCanvas = document.getElementById('rain-canvas');
Â  Â  Â  Â  const hyperspaceCanvas = document.getElementById('hyperspace-canvas');
Â  Â  Â  Â  const plasmaCanvas = document.getElementById('plasma-canvas');
Â  Â  Â  Â  const forestCanvas = document.getElementById('forest-canvas');
Â  Â  Â  Â  const neongridCanvas = document.getElementById('neongrid-canvas');
Â  Â  Â  Â  const sakuraCanvas = document.getElementById('sakura-canvas');
Â  Â  Â  Â  const quantumCanvas = document.getElementById('quantum-canvas');
Â  Â  Â  Â  const digitalrainCanvas = document.getElementById('digitalrain-canvas');
Â  Â  Â  Â  const sandsCanvas = document.getElementById('sands-canvas');
Â  Â  Â  Â  const inkblotCanvas = document.getElementById('inkblot-canvas');
Â  Â  Â  Â  const cosmicCanvas = document.getElementById('cosmic-canvas');
Â  Â  Â  Â  const musicvizCanvas = document.getElementById('musicviz-canvas');
Â  Â  Â  Â  const bioforestCanvas = document.getElementById('bioforest-canvas');
Â  Â  Â  Â  const stainedglassCanvas = document.getElementById('stainedglass-canvas');
Â  Â  Â  Â  const wateryCanvas = document.getElementById('watery-canvas');
Â  Â  Â  Â  const swarmCanvas = document.getElementById('swarm-canvas');
Â  Â  Â  Â  const glitchCanvas = document.getElementById('glitch-canvas');
Â  Â  Â  Â  const auroraCanvas = document.getElementById('aurora-canvas');
Â  Â  Â  Â  const constellationCanvas = document.getElementById('constellation-canvas');
Â  Â  Â  Â  const synthwaveCanvas = document.getElementById('synthwave-canvas');
Â  Â  Â  Â  const nebulaCanvas = document.getElementById('nebula-canvas');
Â  Â  Â  Â  const jungleCanvas = document.getElementById('jungle-canvas');
Â  Â  Â  Â  const cityscapeCanvas = document.getElementById('cityscape-canvas');
Â  Â  Â  Â  const paintCanvas = document.getElementById('paint-canvas');
Â  Â  Â  Â  const laserGridCanvas = document.getElementById('laserGrid-canvas');
Â  Â  Â  Â  const neonPalmsCanvas = document.getElementById('neonPalms-canvas');
Â  Â  Â  Â  const memphisCanvas = document.getElementById('memphis-canvas');
Â  Â  Â  Â  const cassetteCanvas = document.getElementById('cassette-canvas');
Â  Â  Â  Â  const eightBitCityCanvas = document.getElementById('eightBitCity-canvas');


Â  Â  Â  Â  // --- Game Constants ---
Â  Â  Â  Â  // These are the fundamental rules and definitions for the game, such as suits,
Â  Â  Â  Â  // values, level progression, and achievement details.
Â  Â  Â  Â  const SUITS = ['â™¥', 'â™¦', 'â™£', 'â™ '];
Â  Â  Â  Â  const VALUES = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
Â  Â  Â  Â  const CARD_OVERLAP = 28;
Â  Â  Â  Â  const LEVEL_THRESHOLDS = (() => {
Â  Â  Â  Â  Â  Â  const thresholds = [0];
Â  Â  Â  Â  Â  Â  for (let i = 1; i < 101; i++) { // Extended to level 100 for new unlocks
Â  Â  Â  Â  Â  Â  Â  Â  thresholds.push(thresholds[i-1] + (i * 10) + 10);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return thresholds;
Â  Â  Â  Â  })();
Â  Â  Â  Â  const COMBO_WORDS = ["Good!", "Great!", "Excellent!", "Amazing!", "Wonderful!", "SUPER!", "INCREDIBLE!", "UNSTOPPABLE!", "GODLIKE!"];
Â  Â  Â  Â  const CARD_BACKS = [
Â  Â  Â  Â  Â  Â  ...Array.from({length: 50}, (_, i) => ({ id: `back-${i}`, name: `Style ${i+1}`, type: 'procedural' })),
Â  Â  Â  Â  Â  Â  { id: 'animated-vortex', name: 'Vortex', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-scanlines', name: 'Scan Lines', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-pulse', name: 'Pulse', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-rainbow', name: 'Rainbow Shift', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-circuitry', name: 'Circuitry', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-liquid', name: 'Liquid Metal', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-stars', name: 'Twinkling Stars', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-ice', name: 'Glacial Ice', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-runes', name: 'Arcane Runes', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'animated-molten', name: 'Molten Core', type: 'animated' }
Â  Â  Â  Â  ];

Â  Â  Â  Â  function shuffleArray(array) {
Â  Â  Â  Â  Â  Â  for (let i = array.length - 1; i > 0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));
Â  Â  Â  Â  Â  Â  Â  Â  [array[i], array[j]] = [array[j], array[i]];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const SHUFFLED_CARD_BACKS = (() => {
Â  Â  Â  Â  Â  Â  const defaultBack = CARD_BACKS.find(b => b.id === 'back-0');
Â  Â  Â  Â  Â  Â  const otherBacks = CARD_BACKS.filter(b => b.id !== 'back-0');
Â  Â  Â  Â  Â  Â  shuffleArray(otherBacks);
Â  Â  Â  Â  Â  Â  return [defaultBack, ...otherBacks];
Â  Â  Â  Â  })();

Â  Â  Â  Â  const BOARD_DATA = [
Â  Â  Â  Â  Â  Â  { id: 'board-0', name: 'Classic Green', type: 'procedural' },
Â  Â  Â  Â  Â  Â  { id: 'board-1', name: 'Lava Lamp', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-2', name: 'Starfield', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-3', name: 'Ocean Waves', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-4', name: 'Matrix', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-5', name: 'Geometric', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-6', name: 'Soothing Fire', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-7', name: 'Gentle Rain', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-8', name: 'Hyperspace', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-9', name: 'Plasma', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-10', name: 'Enchanted Forest', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-11', name: 'Neon Grid', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-12', name: 'Sakura Blizzard', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-13', name: 'Quantum Foam', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-14', name: 'Digital Rain', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-15', name: 'Shifting Sands', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-16', name: 'Ink Blot', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-17', name: 'Cosmic Ripples', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-18', name: 'Musical Visualizer', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-19', name: 'Bioluminescent Forest', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-20', name: 'Stained Glass', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-21', name: 'Watery Surface', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-22', name: 'Particle Swarm', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-23', name: 'Glitchscape', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-24', name: 'Aurora Borealis', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-25', name: 'Interactive Constellations', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-26', name: 'Synthwave Sunset', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-27', name: 'Deep Space Nebula', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-28', name: 'Jungle Canopy', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-29', name: 'Cityscape at Night', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-30', name: 'Abstract Paint', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-31', name: 'Laser Grid', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-32', name: 'Neon Palms', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-33', name: 'Memphis Pattern', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-34', name: 'Cassette Tape', type: 'animated' },
Â  Â  Â  Â  Â  Â  { id: 'board-35', name: '8-bit City', type: 'animated' },
Â  Â  Â  Â  Â  Â  ...Array.from({length: 24}, (_, i) => ({ id: `board-${i + 36}`, name: `Pattern ${i + 1}`, type: 'procedural' }))
Â  Â  Â  Â  ];
Â  Â  Â  Â  const MUSIC_DATA = Array.from({length: 10}, (_, i) => ({
Â  Â  Â  Â  Â  Â  id: `track-${i+1}`,
Â  Â  Â  Â  Â  Â  name: `Track ${String(i + 1).padStart(2, '0')}`,
Â  Â  Â  Â  Â  Â  url: `https://raw.githubusercontent.com/cdbyall/solitaire/main/music/${String(i + 1).padStart(2, '0')}.mp3`
Â  Â  Â  Â  }));
Â  Â  Â  Â  const ACHIEVEMENTS = {
Â  Â  Â  Â  Â  Â  firstMove: { name: "Getting Started", desc: "Make your first move.", xp: 1, icon: "â–¶ï¸", points: 10 },
Â  Â  Â  Â  Â  Â  firstFoundation: { name: "On the Up and Up", desc: "Place your first card on a foundation.", xp: 5, icon: "ğŸ†", points: 10 },
Â  Â  Â  Â  Â  Â  kingMe: { name: "All Hail the King", desc: "Place a King on an empty tableau pile.", xp: 5, icon: "ğŸ‘‘", points: 10 },
Â  Â  Â  Â  Â  Â  clearPile: { name: "Clean Sweep", desc: "Clear a tableau pile of all cards.", xp: 10, icon: "ğŸ§¹", points: 20 },
Â  Â  Â  Â  Â  Â  combo5: { name: "Chain Reaction", desc: "Achieve a x5 combo.", xp: 10, icon: "ğŸ”¥", points: 20 },
Â  Â  Â  Â  Â  Â  speedy: { name: "Quick Draw", desc: "Win a game in under 5 minutes.", xp: 25, icon: "â±ï¸", points: 50 },
Â  Â  Â  Â  Â  Â  win1: { name: "First Victory", desc: "Win your first game.", xp: 10, icon: "ğŸ¥‡", points: 20 },
Â  Â  Â  Â  Â  Â  win5: { name: "Five-Timer", desc: "Win 5 games.", xp: 20, icon: "ğŸ–ï¸", points: 50 },
Â  Â  Â  Â  Â  Â  win10: { name: "Decade of Dominance", desc: "Win 10 games.", xp: 50, icon: "ğŸ”Ÿ", points: 100 },
Â  Â  Â  Â  Â  Â  winStreak2: { name: "Double Down", desc: "Win 2 games in a row.", xp: 20, icon: "âœŒï¸", points: 50 },
Â  Â  Â  Â  Â  Â  winStreak3: { name: "Triple Threat", desc: "Win 3 games in a row.", xp: 50, icon: "ğŸ”¥", points: 100 },
Â  Â  Â  Â  Â  Â  newGameSpam: { name: "A Bit Impatient?", desc: "Click 'New Game' 5 times in 10 seconds.", xp: 0, icon: "ğŸ˜ ", points: 10, secret: true },
Â  Â  Â  Â  Â  Â  fullStack1: { name: "Column Major", desc: "Build a full stack from King to Ace.", xp: 20, icon: "ğŸ›ï¸", points: 20 },
Â  Â  Â  Â  Â  Â  fullStack2: { name: "Major Major", desc: "Build two full stacks in one game.", xp: 50, icon: "ğŸ›ï¸ğŸ›ï¸", points: 50 },
Â  Â  Â  Â  Â  Â  firstUndo: { name: "Second Thoughts", desc: "Use the Undo button for the first time.", xp: 1, icon: "âŒ", points: 10 },
Â  Â  Â  Â  Â  Â  firstHint: { name: "A Little Help?", desc: "Use the Hint button for the first time.", xp: 1, icon: "ğŸ’¡", points: 10 },
Â  Â  Â  Â  Â  Â  level2: { name: "Rookie", desc: "Reach Level 2.", xp: 10, icon: "â­", points: 10 },
Â  Â  Â  Â  Â  Â  level5: { name: "Veteran", desc: "Reach Level 5.", xp: 20, icon: "â­â­", points: 20 },
Â  Â  Â  Â  Â  Â  level10: { name: "Solitaire Pro", desc: "Reach Level 10.", xp: 50, icon: "â­â­â­", points: 50 },
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- Game State Variables ---
Â  Â  Â  Â  // These variables track the current state of the game, including the card piles,
Â  Â  Â  Â  // player progress, and various settings.
Â  Â  Â  Â  let stock = [], waste = [], foundations = [[], [], [], []], tableau = [[], [], [], [], [], [], []];
Â  Â  Â  Â  let drawCount = 3;
Â  Â  Â  Â  let isGameWon = false;
Â  Â  Â  Â  let winCount = 0;
Â  Â  Â  Â  let winStreak = 0;
Â  Â  Â  Â  let unlockedBacks = ['back-0'];
Â  Â  Â  Â  let selectedBack = 'back-0';
Â  Â  Â  Â  let unlockedBoards = ['board-0'];
Â  Â  Â  Â  let selectedBoard = 'board-0';
Â  Â  Â  Â  let faceStyle = 'default';
Â  Â  Â  Â  let playerXP = 0;
Â  Â  Â  Â  let playerLevel = 1;
Â  Â  Â  Â  let hintsAvailable = 0;
Â  Â  Â  Â  let undosAvailable = 0;
Â  Â  Â  Â  let gameTimerInterval;
Â  Â  Â  Â  let gameTime = 0;
Â  Â  Â  Â  let lastStockClickTime = 0;
Â  Â  Â  Â  let moveHistory = [];
Â  Â  Â  Â  let unlockedAchievements = [];
Â  Â  Â  Â  let achievementScore = 0;
Â  Â  Â  Â  let newGameClickTimes = [];
Â  Â  Â  Â  let lastLifeLostTime = 0;
Â  Â  Â  Â  let devUnlockCounter = 0; // Counter for the secret unlock code
Â  Â  Â  Â  let isMuted = false;
Â  Â  Â  Â  let unlockedTracks = ['track-1'];
Â  Â  Â  Â  let currentTrackPlayer;
Â  Â  Â  Â  let currentTrackIndex = -1;
Â  Â  Â  Â  let shuffledPlaylist = [];
Â  Â  Â  Â  let introPlayer;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Drag & Drop State ---
Â  Â  Â  Â  // Manages the state related to dragging and dropping cards.
Â  Â  Â  Â  let isDragging = false;
Â  Â  Â  Â  let dragProxyEl = null;
Â  Â  Â  Â  let draggedCardInfo = null;
Â  Â  Â  Â  let offsetX, offsetY;
Â  Â  Â  Â  let clickTimeout = null;
Â  Â  Â  Â  let lastClickTime = 0;
Â  Â  Â  Â  let mouseDownPos = null;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Game-specific XP State ---
Â  Â  Â  Â  // Tracks bonuses awarded within a single game session.
Â  Â  Â  Â  let aceBonusAwarded = false;
Â  Â  Â  Â  let tableauBonusAwarded = [];

Â  Â  Â  Â  // --- Combo State ---
Â  Â  Â  Â  // Manages the combo system for consecutive moves.
Â  Â  Â  Â  let lastMoveTime = 0;
Â  Â  Â  Â  let comboCounter = 0;
Â  Â  Â  Â  let comboTimeout;

Â  Â  Â  Â  // --- Physics Engine ---
Â  Â  Â  Â  // Matter.js variables for handling physics-based animations.
Â  Â  Â  Â  let engine, matterRender, world, mouseConstraint;
Â  Â  Â  Â  let comboBodies = [];
Â  Â  Â  Â  let winAnimationTimeout;

Â  Â  Â  Â  // --- Animated Backgrounds ---
Â  Â  Â  Â  // Contexts and animation IDs for the various canvas-based backgrounds.
Â  Â  Â  Â  let starfieldCtx, stars = [], starfieldAnimationId = null;
Â  Â  Â  Â  let lavalampCtx, blobs = [], lavalampAnimationId = null;
Â  Â  Â  Â  let oceanCtx, waveTime = 0, oceanAnimationId = null;
Â  Â  Â  Â  let matrixCtx, drops = [], matrixAnimationId = null;
Â  Â  Â  Â  let geometricCtx, geoTime = 0, geometricAnimationId = null;
Â  Â  Â  Â  let fireCtx, particles = [], fireAnimationId = null;
Â  Â  Â  Â  let rainCtx, raindrops = [], rainAnimationId = null;
Â  Â  Â  Â  let hyperspaceCtx, hyperStars = [], hyperspaceAnimationId = null;
Â  Â  Â  Â  let plasmaCtx, plasmaTime = 0, plasmaAnimationId = null;
Â  Â  Â  Â  let forestCtx, leaves = [], forestAnimationId = null;
Â  Â  Â  Â  let neongridCtx, neongridAnimationId = null;
Â  Â  Â  Â  let sakuraCtx, sakuraPetals = [], sakuraAnimationId = null;
Â  Â  Â  Â  let quantumCtx, quantumParticles = [], quantumAnimationId = null;
Â  Â  Â  Â  let digitalrainCtx, digitalDrops = [], digitalrainAnimationId = null;
Â  Â  Â  Â  let sandsCtx, sandTime = 0, sandsAnimationId = null;
Â  Â  Â  Â  let inkblotCtx, inkblots = [], inkblotAnimationId = null;
Â  Â  Â  Â  let cosmicCtx, cosmicStars = [], cosmicRipples = [], cosmicAnimationId = null;
Â  Â  Â  Â  let musicvizCtx, analyser, musicvizAnimationId = null;
Â  Â  Â  Â  let bioforestCtx, bioPlants = [], bioforestAnimationId = null;
Â  Â  Â  Â  let stainedglassCtx, glassPanes = [], stainedglassAnimationId = null;
Â  Â  Â  Â  let wateryCtx, wateryRipples = [], wateryAnimationId = null;
Â  Â  Â  Â  let swarmCtx, swarmParticles = [], swarmAnimationId = null;
Â  Â  Â  Â  let glitchCtx, glitchData, glitchAnimationId = null;
Â  Â  Â  Â  let auroraCtx, auroraParticles = [], auroraAnimationId = null;
Â  Â  Â  Â  let constellationCtx, constellationStars = [], constellationLines = [], constellationAnimationId = null;
Â  Â  Â  Â  let synthwaveCtx, synthwaveTime = 0, synthwaveAnimationId = null;
Â  Â  Â  Â  let nebulaCtx, nebulaParticles = [], nebulaAnimationId = null;
Â  Â  Â  Â  let jungleCtx, jungleVines = [], jungleAnimationId = null;
Â  Â  Â  Â  let cityscapeCtx, cityscapeWindows = [], cityscapeAnimationId = null;
Â  Â  Â  Â  let paintCtx, paintBlobs = [], paintAnimationId = null;
Â  Â  Â  Â  let laserGridCtx, laserGridTime = 0, laserGridAnimationId = null;
Â  Â  Â  Â  let neonPalmsCtx, neonPalmsTime = 0, neonPalmsAnimationId = null;
Â  Â  Â  Â  let memphisCtx, memphisShapes = [], memphisAnimationId = null;
Â  Â  Â  Â  let cassetteCtx, cassetteTime = 0, cassetteAnimationId = null;
Â  Â  Â  Â  let eightBitCityCtx, eightBitCityBuildings = [], eightBitCityAnimationId = null;
Â  Â  Â  Â  let mousePos = { x: 0, y: 0 };
Â  Â  Â  Â  let currentApplyCallback = null;
Â  Â  Â  Â  let unlockPopupQueue = [];
Â  Â  Â  Â  let isPopupVisible = false;


Â  Â  Â  Â  // --- Sound Engine ---
Â  Â  Â  Â  // Initializes the sound effects using Tone.js for an immersive audio experience.
Â  Â  Â  Â  let sounds;
Â  Â  Â  Â  function setupSounds() {
Â  Â  Â  Â  Â  Â  sounds = {
Â  Â  Â  Â  Â  Â  Â  Â  place: new Tone.PolySynth(Tone.Synth, { oscillator: { type: 'sine' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 } }).toDestination(),
Â  Â  Â  Â  Â  Â  Â  Â  foundationPlace: new Tone.PolySynth(Tone.MetalSynth, { frequency: 200, envelope: { attack: 0.001, decay: 0.4, release: 0.2 }, harmonicity: 5.1, modulationIndex: 32, resonance: 4000, octaves: 1.5 }).toDestination(),
Â  Â  Â  Â  Â  Â  Â  Â  error: new Tone.PolySynth(Tone.Synth, { oscillator: { type: 'square' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0 } }).toDestination(),
Â  Â  Â  Â  Â  Â  Â  Â  win: new Tone.PolySynth(Tone.Synth).toDestination(),
Â  Â  Â  Â  Â  Â  Â  Â  click: new Tone.PolySynth(Tone.MembraneSynth).toDestination(),
Â  Â  Â  Â  Â  Â  Â  Â  levelUp: new Tone.Synth().toDestination(),
Â  Â  Â  Â  Â  Â  Â  Â  achievement: new Tone.PluckSynth({ attackNoise: 0.5, dampening: 4000, resonance: 0.9 }).toDestination(),
Â  Â  Â  Â  Â  Â  Â  Â  combo: new Tone.PolySynth(Tone.FMSynth, { harmonicity: 3, modulationIndex: 10, detune: 0, oscillator: { type: "sine" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.5, release: 0.5 }, modulation: { type: "square" }, modulationEnvelope: { attack: 0.01, decay: 0.2, sustain: 0.5, release: 0.5 } }).toDestination(),
Â  Â  Â  Â  Â  Â  Â  Â  pop: new Tone.PolySynth(Tone.MembraneSynth, { pitchDecay: 0.01, octaves: 2, oscillator: { type: "sine" }, envelope: { attack: 0.001, decay: 0.1, sustain: 0.01, release: 0.01 } }).toDestination(),
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  // Create an analyser node to get frequency data for the visualizer
Â  Â  Â  Â  Â  Â  analyser = new Tone.Analyser('fft', 32);
Â  Â  Â  Â  Â  Â  Tone.getDestination().connect(analyser);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Game Initialization ---
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Creates the animated card fan effect on the title screen.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function animateTitleScreen() {
Â  Â  Â  Â  Â  Â  const container = document.querySelector('.title-cards');
Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  const titleSuits = ['â™¥', 'â™¦', 'â™£', 'â™ ', 'â˜…'];
Â  Â  Â  Â  Â  Â  for (let i = 0; i < 5; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'title-card';
Â  Â  Â  Â  Â  Â  Â  Â  card.style.setProperty('--rot', `${(i - 2) * 15}deg`);
Â  Â  Â  Â  Â  Â  Â  Â  card.style.setProperty('--i', i);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const cardInner = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  cardInner.className = 'title-card-inner';

Â  Â  Â  Â  Â  Â  Â  Â  const cardFront = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  cardFront.className = 'title-card-front';
Â  Â  Â  Â  Â  Â  Â  Â  cardFront.textContent = titleSuits[i];
Â  Â  Â  Â  Â  Â  Â  Â  cardFront.style.color = (i < 2) ? '#d90429' : '#000000';

Â  Â  Â  Â  Â  Â  Â  Â  const cardBack = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  cardBack.className = 'title-card-back';

Â  Â  Â  Â  Â  Â  Â  Â  cardInner.appendChild(cardFront);
Â  Â  Â  Â  Â  Â  Â  Â  cardInner.appendChild(cardBack);
Â  Â  Â  Â  Â  Â  Â  Â  card.appendChild(cardInner);
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(card);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Sets up the Matter.js physics engine for combo text animations.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function setupPhysics() {
Â  Â  Â  Â  Â  Â  const { Engine, Render, World, Bodies, Mouse, MouseConstraint, Runner, Events } = Matter;
Â  Â  Â  Â  Â  Â  engine = Engine.create({ gravity: { y: 0.2 } });
Â  Â  Â  Â  Â  Â  world = engine.world;
Â  Â  Â  Â  Â  Â  matterRender = Render.create({
Â  Â  Â  Â  Â  Â  Â  Â  canvas: comboCanvas,
Â  Â  Â  Â  Â  Â  Â  Â  engine: engine,
Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: window.innerWidth,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height: window.innerHeight,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wireframes: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  background: 'transparent'
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const mouse = Mouse.create(matterRender.canvas);
Â  Â  Â  Â  Â  Â  mouseConstraint = MouseConstraint.create(engine, {
Â  Â  Â  Â  Â  Â  Â  Â  mouse: mouse,
Â  Â  Â  Â  Â  Â  Â  Â  constraint: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stiffness: 0.2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  render: { visible: false }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  World.add(world, mouseConstraint);
Â  Â  Â  Â  Â  Â  matterRender.mouse = mouse;

Â  Â  Â  Â  Â  Â  Runner.run(engine);
Â  Â  Â  Â  Â  Â  Render.run(matterRender);

Â  Â  Â  Â  Â  Â  // Allow user to pop the combo text bodies by clicking them
Â  Â  Â  Â  Â  Â  Events.on(mouseConstraint, 'mousedown', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  const clickedBody = Matter.Query.point(comboBodies, event.mouse.position)[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (clickedBody) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sounds.pop.triggerAttackRelease("C3", "8n");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Matter.World.remove(world, clickedBody);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comboBodies = comboBodies.filter(b => b !== clickedBody);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // ===== CODE FIX STARTS HERE =====
Â  Â  Â  Â  // The original code had a race condition where the game could start before the audio was ready,
Â  Â  Â  Â  // causing a script error. This new logic ensures all setup is done sequentially after the
Â  Â  Â  Â  // "Start Game" button is clicked, preventing the error.
Â  Â  Â  Â Â 
Â  Â  Â  Â  startGameBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  // The `Tone.start()` method must be called after a user interaction (like this click).
Â  Â  Â  Â  Â  Â  // It returns a Promise that resolves when the audio context is ready.
Â  Â  Â  Â  Â  Â  // We wrap the entire game start sequence in the `.then()` block to ensure
Â  Â  Â  Â  Â  Â  // that sounds are ready before any game logic that uses them is run.
Â  Â  Â  Â  Â  Â  Tone.start().then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  // 1. Set up all necessary systems now that audio is confirmed to be active.
Â  Â  Â  Â  Â  Â  Â  Â  setupSounds();
Â  Â  Â  Â  Â  Â  Â  Â  setupPhysics();

Â  Â  Â  Â  Â  Â  Â  Â  // 2. Play a click sound.
Â  Â  Â  Â  Â  Â  Â  Â  sounds.click.triggerAttackRelease("C2", "8n");

Â  Â  Â  Â  Â  Â  Â  Â  // 3. Transition from title screen to game screen.
Â  Â  Â  Â  Â  Â  Â  Â  titleScreen.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  gameContainer.style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 4. Load saved progress and start intro music.
Â  Â  Â  Â  Â  Â  Â  Â  loadProgress();
Â  Â  Â  Â  Â  Â  Â  Â  introPlayer = new Tone.Player("https://raw.githubusercontent.com/cdbyall/solitaire/main/music/00.mp3").toDestination();
Â  Â  Â  Â  Â  Â  Â  Â  introPlayer.loop = true;
Â  Â  Â  Â  Â  Â  Â  Â  introPlayer.autostart = true;
Â  Â  Â  Â  Â  Â  Â  Â  updateMuteState(false); // Apply mute settings without playing a sound

Â  Â  Â  Â  Â  Â  Â  Â  // 5. Finally, prompt the user for game options. This will lead to the game starting correctly.
Â  Â  Â  Â  Â  Â  Â  Â  promptNewGame();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }, { once: true }); // Use { once: true } to ensure this complex setup only runs one time.
Â  Â  Â  Â  // ===== CODE FIX ENDS HERE =====


Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Shows the initial modals to select game options.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function promptNewGame() {
Â  Â  Â  Â  Â  Â  drawSelectModal.style.display = 'flex';
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Resets the game state and deals a new set of cards.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function initializeNewGame() {
Â  Â  Â  Â  Â  Â  if (introPlayer) {
Â  Â  Â  Â  Â  Â  Â  Â  introPlayer.stop();
Â  Â  Â  Â  Â  Â  Â  Â  introPlayer.dispose();
Â  Â  Â  Â  Â  Â  Â  Â  introPlayer = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  startMainPlaylist();

Â  Â  Â  Â  Â  Â  if (!isGameWon) {
Â  Â  Â  Â  Â  Â  Â  Â  winStreak = 0; // Reset streak if the previous game wasn't won
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  isGameWon = false;
Â  Â  Â  Â  Â  Â  aceBonusAwarded = false;
Â  Â  Â  Â  Â  Â  tableauBonusAwarded = [false, false, false, false, false, false, false];
Â  Â  Â  Â  Â  Â  resetCombo();
Â  Â  Â  Â  Â  Â  startTimer();
Â  Â  Â  Â  Â  Â  clearTimeout(winAnimationTimeout);
Â  Â  Â  Â  Â  Â  comboCanvas.style.pointerEvents = 'none';
Â  Â  Â  Â  Â  Â  moveHistory = [];
Â  Â  Â  Â  Â  Â  gameTimerEl.textContent = '00:00';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Secret achievement check for spamming "New Game"
Â  Â  Â  Â  Â  Â  newGameClickTimes.push(Date.now());
Â  Â  Â  Â  Â  Â  if (newGameClickTimes.length > 5) {
Â  Â  Â  Â  Â  Â  Â  Â  newGameClickTimes.shift();
Â  Â  Â  Â  Â  Â  Â  Â  if (newGameClickTimes[4] - newGameClickTimes[0] < 10000) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  triggerAchievement('newGameSpam');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Reset all card piles
Â  Â  Â  Â  Â  Â  stock = []; waste = []; foundations = [[], [], [], []];
Â  Â  Â  Â  Â  Â  tableau = Array.from({ length: 7 }, () => []);
Â  Â  Â  Â  Â  Â  messageBox.textContent = '';
Â  Â  Â  Â  Â  Â  autocompleteBtn.classList.add('hidden');
Â  Â  Â  Â  Â  Â  gameBoard.style.pointerEvents = 'auto';
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.win-animate, .hint-glow').forEach(el => el.classList.remove('win-animate', 'hint-glow'));

Â  Â  Â  Â  Â  Â  // Create, shuffle, and deal the deck
Â  Â  Â  Â  Â  Â  const deck = createDeck();
Â  Â  Â  Â  Â  Â  shuffleDeck(deck);
Â  Â  Â  Â  Â  Â  dealCards(deck);
Â  Â  Â  Â  Â  Â  updateCardStyles();
Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  Â  updatePlayerStatsUI();
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Data Persistence ---
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Loads player progress from localStorage.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function loadProgress() {
Â  Â  Â  Â  Â  Â  winCount = parseInt(localStorage.getItem('solitaireWinCount') || '0');
Â  Â  Â  Â  Â  Â  winStreak = parseInt(localStorage.getItem('solitaireWinStreak') || '0');
Â  Â  Â  Â  Â  Â  unlockedBacks = JSON.parse(localStorage.getItem('solitaireUnlockedBacks') || '["back-0"]');
Â  Â  Â  Â  Â  Â  selectedBack = localStorage.getItem('solitaireSelectedBack') || 'back-0';
Â  Â  Â  Â  Â  Â  unlockedBoards = JSON.parse(localStorage.getItem('solitaireUnlockedBoards') || '["board-0"]');
Â  Â  Â  Â  Â  Â  selectedBoard = localStorage.getItem('solitaireSelectedBoard') || 'board-0';
Â  Â  Â  Â  Â  Â  playerXP = parseInt(localStorage.getItem('solitairePlayerXP') || '0');
Â  Â  Â  Â  Â  Â  hintsAvailable = parseInt(localStorage.getItem('solitaireHintsAvailable') || '0');
Â  Â  Â  Â  Â  Â  undosAvailable = parseInt(localStorage.getItem('solitaireUndosAvailable') || '0');
Â  Â  Â  Â  Â  Â  unlockedAchievements = JSON.parse(localStorage.getItem('solitaireAchievements') || '[]');
Â  Â  Â  Â  Â  Â  achievementScore = parseInt(localStorage.getItem('solitaireAchievementScore') || '0');
Â  Â  Â  Â  Â  Â  isMuted = JSON.parse(localStorage.getItem('solitaireIsMuted') || 'false');
Â  Â  Â  Â  Â  Â  unlockedTracks = JSON.parse(localStorage.getItem('solitaireUnlockedTracks')) || ['track-1'];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  checkLevelUp(false); // Update level based on loaded XP
Â  Â  Â  Â  Â  Â  updateMuteState(false); // Update mute state without playing sound
Â  Â  Â  Â  Â  Â  updateCardStyles();
Â  Â  Â  Â  Â  Â  updatePlayerStatsUI();
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Saves player progress to localStorage.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function saveProgress() {
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireWinCount', winCount);
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireWinStreak', winStreak);
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireUnlockedBacks', JSON.stringify(unlockedBacks));
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireSelectedBack', selectedBack);
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireUnlockedBoards', JSON.stringify(unlockedBoards));
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireSelectedBoard', selectedBoard);
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitairePlayerXP', playerXP);
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireHintsAvailable', hintsAvailable);
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireUndosAvailable', undosAvailable);
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireAchievements', JSON.stringify(unlockedAchievements));
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireAchievementScore', achievementScore);
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireIsMuted', JSON.stringify(isMuted));
Â  Â  Â  Â  Â  Â  localStorage.setItem('solitaireUnlockedTracks', JSON.stringify(unlockedTracks));
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Animated Backgrounds ---
Â  Â  Â  Â  // Each background has setup, animate, start, and stop functions.
Â  Â  Â  Â  // They manage their own canvas, animation loop, and state.
Â  Â  Â  Â Â 
Â  Â  Â  Â  function setupStarfield() { if (!starfieldCanvas) return; starfieldCanvas.width = window.innerWidth; starfieldCanvas.height = window.innerHeight; starfieldCtx = starfieldCanvas.getContext('2d'); stars = []; const numStars = window.innerWidth < 600 ? 400 : 800; const w = starfieldCanvas.width; const h = starfieldCanvas.height; for(let i = 0; i < numStars; i++) { stars.push({ x: Math.random() * w - w / 2, y: Math.random() * h - h / 2, z: Math.random() * w }); } }
Â  Â  Â  Â  function animateStarfield() { if (!starfieldCtx) return; const w = starfieldCanvas.width; const h = starfieldCanvas.height; const speed = 2; starfieldCtx.fillStyle = 'rgba(0, 0, 0, 0.2)'; starfieldCtx.fillRect(0, 0, w, h); starfieldCtx.fillStyle = 'white'; stars.forEach(star => { star.z -= speed; if (star.z <= 0) { star.x = Math.random() * w - w / 2; star.y = Math.random() * h / 2; star.z = w; } const k = 128.0 / star.z; const px = star.x * k + w / 2; const py = star.y * k + h / 2; if (px >= 0 && px < w && py >= 0 && py < h) { const size = (1 - star.z / w) * 5; starfieldCtx.fillRect(px, py, size, size); } }); starfieldAnimationId = requestAnimationFrame(animateStarfield); }
Â  Â  Â  Â  function startStarfield() { if (starfieldAnimationId) return; if (!starfieldCanvas) return; starfieldCanvas.style.display = 'block'; setupStarfield(); animateStarfield(); }
Â  Â  Â  Â  function stopStarfield() { if (!starfieldAnimationId) return; cancelAnimationFrame(starfieldAnimationId); starfieldAnimationId = null; if (starfieldCanvas) starfieldCanvas.style.display = 'none'; }
Â  Â  Â  Â  class Blob { constructor(w, h) { this.w = w; this.h = h; this.x = Math.random() * w; this.y = Math.random() * h; this.vx = (Math.random() - 0.5) * 2; this.vy = (Math.random() - 0.5) * 2; this.radius = Math.random() * 40 + 40; } update() { this.x += this.vx; this.y += this.vy; if (this.x < this.radius || this.x > this.w - this.radius) this.vx *= -1; if (this.y < this.radius || this.y > this.h - this.radius) this.vy *= -1; } }
Â  Â  Â  Â  function setupLavalamp() { if (!lavalampCanvas) return; lavalampCanvas.width = window.innerWidth; lavalampCanvas.height = window.innerHeight; lavalampCtx = lavalampCanvas.getContext('2d'); blobs = []; const numBlobs = 10; for(let i=0; i<numBlobs; i++) { blobs.push(new Blob(lavalampCanvas.width, lavalampCanvas.height)); } }
Â  Â  Â  Â  function animateLavalamp() { if (!lavalampCtx) return; lavalampCtx.clearRect(0, 0, lavalampCanvas.width, lavalampCanvas.height); const bgGradient = lavalampCtx.createLinearGradient(0, 0, 0, lavalampCanvas.height); bgGradient.addColorStop(0, "#3a1c71"); bgGradient.addColorStop(0.5, "#d76d77"); bgGradient.addColorStop(1, "#ffaf7b"); lavalampCtx.fillStyle = bgGradient; lavalampCtx.fillRect(0, 0, lavalampCanvas.width, lavalampCanvas.height); lavalampCtx.filter = 'blur(40px) contrast(30)'; lavalampCtx.beginPath(); blobs.forEach(blob => { blob.update(); lavalampCtx.moveTo(blob.x, blob.y); lavalampCtx.arc(blob.x, blob.y, blob.radius, 0, Math.PI * 2); }); lavalampCtx.fillStyle = 'white'; lavalampCtx.fill(); lavalampCtx.filter = 'none'; lavalampAnimationId = requestAnimationFrame(animateLavalamp); }
Â  Â  Â  Â  function startLavalamp() { if (lavalampAnimationId) return; if (!lavalampCanvas) return; lavalampCanvas.style.display = 'block'; setupLavalamp(); animateLavalamp(); }
Â  Â  Â  Â  function stopLavalamp() { if (!lavalampAnimationId) return; cancelAnimationFrame(lavalampAnimationId); lavalampAnimationId = null; if (lavalampCanvas) lavalampCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupOcean() { if (!oceanCanvas) return; oceanCanvas.width = window.innerWidth; oceanCanvas.height = window.innerHeight; oceanCtx = oceanCanvas.getContext('2d'); waveTime = 0; }
Â  Â  Â  Â  function animateOcean() { if (!oceanCtx) return; const w = oceanCanvas.width; const h = oceanCanvas.height; oceanCtx.fillStyle = '#001f3f'; oceanCtx.fillRect(0, 0, w, h); waveTime += 0.02; const drawWave = (color, alpha, speed, amplitude, frequency) => { oceanCtx.fillStyle = color; oceanCtx.globalAlpha = alpha; oceanCtx.beginPath(); oceanCtx.moveTo(0, h); for (let x = 0; x < w; x++) { const y = Math.sin(x * frequency + waveTime * speed) * amplitude + h * 0.7; oceanCtx.lineTo(x, y); } oceanCtx.lineTo(w, h); oceanCtx.fill(); }; drawWave('#7FDBFF', 0.5, 0.8, 40, 0.01); drawWave('#0074D9', 0.5, 1, 50, 0.008); drawWave('#001f3f', 0.5, 1.2, 60, 0.006); oceanCtx.globalAlpha = 1; oceanAnimationId = requestAnimationFrame(animateOcean); }
Â  Â  Â  Â  function startOcean() { if (oceanAnimationId) return; if (!oceanCanvas) return; oceanCanvas.style.display = 'block'; setupOcean(); animateOcean(); }
Â  Â  Â  Â  function stopOcean() { if (!oceanAnimationId) return; cancelAnimationFrame(oceanAnimationId); oceanAnimationId = null; if (oceanCanvas) oceanCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupMatrix() { if (!matrixCanvas) return; matrixCanvas.width = window.innerWidth; matrixCanvas.height = window.innerHeight; matrixCtx = matrixCanvas.getContext('2d'); const columns = matrixCanvas.width / 20; drops = []; for (let x = 0; x < columns; x++) { drops[x] = 1; } }
Â  Â  Â  Â  function animateMatrix() { if (!matrixCtx) return; matrixCtx.fillStyle = 'rgba(0, 0, 0, 0.05)'; matrixCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height); matrixCtx.fillStyle = '#0F0'; matrixCtx.font = '15px monospace'; const katakana = 'ã‚¢ã‚¡ã‚«ã‚µã‚¿ãƒŠãƒãƒãƒ¤ãƒ£ãƒ©ãƒ¯ã‚¬ã‚¶ãƒ€ãƒãƒ‘ã‚¤ã‚£ã‚­ã‚·ãƒãƒ‹ãƒ’ãƒŸãƒªãƒ°ã‚®ã‚¸ãƒ‚ãƒ“ãƒ”ã‚¦ã‚¥ã‚¯ã‚¹ãƒ„ãƒŒãƒ•ãƒ ãƒ¦ãƒ¥ãƒ«ã‚°ã‚ºãƒ–ãƒ…ãƒ—ã‚¨ã‚§ã‚±ã‚»ãƒ†ãƒãƒ˜ãƒ¡ãƒ¬ãƒ±ã‚²ã‚¼ãƒ‡ãƒ™ãƒšã‚ªã‚©ã‚³ã‚½ãƒˆãƒãƒ›ãƒ¢ãƒ¨ãƒ§ãƒ­ãƒ²ã‚´ã‚¾ãƒ‰ãƒœãƒãƒ´ãƒƒãƒ³'; for (let i = 0; i < drops.length; i++) { const text = katakana.charAt(Math.floor(Math.random() * katakana.length)); matrixCtx.fillText(text, i * 20, drops[i] * 20); if (drops[i] * 20 > matrixCanvas.height && Math.random() > 0.975) { drops[i] = 0; } drops[i]++; } matrixAnimationId = requestAnimationFrame(animateMatrix); }
Â  Â  Â  Â  function startMatrix() { if (matrixAnimationId) return; if (!matrixCanvas) return; matrixCanvas.style.display = 'block'; setupMatrix(); animateMatrix(); }
Â  Â  Â  Â  function stopMatrix() { if (!matrixAnimationId) return; cancelAnimationFrame(matrixAnimationId); matrixAnimationId = null; if (matrixCanvas) matrixCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupGeometric() { if (!geometricCanvas) return; geometricCanvas.width = window.innerWidth; geometricCanvas.height = window.innerHeight; geometricCtx = geometricCanvas.getContext('2d'); geoTime = 0; }
Â  Â  Â  Â  function animateGeometric() { if (!geometricCtx) return; const w = geometricCanvas.width; const h = geometricCanvas.height; geometricCtx.fillStyle = 'rgba(20, 20, 30, 0.1)'; geometricCtx.fillRect(0, 0, w, h); geoTime += 0.01; geometricCtx.save(); geometricCtx.translate(w/2, h/2); for (let i = 1; i < 60; i++) { geometricCtx.strokeStyle = `hsla(${i * 10 + geoTime * 100}, 80%, 60%, ${1 - i/60})`; geometricCtx.lineWidth = 2; geometricCtx.beginPath(); const radius = i * 20; const sides = 6; geometricCtx.moveTo(radius, 0); for (let j = 1; j <= sides; j++) { const angle = (j * 2 * Math.PI / sides) + geoTime * (i % 2 === 0 ? 1 : -1); geometricCtx.lineTo(radius * Math.cos(angle), radius * Math.sin(angle)); } geometricCtx.closePath(); geometricCtx.stroke(); } geometricCtx.restore(); geometricAnimationId = requestAnimationFrame(animateGeometric); }
Â  Â  Â  Â  function startGeometric() { if (geometricAnimationId) return; if (!geometricCanvas) return; geometricCanvas.style.display = 'block'; setupGeometric(); animateGeometric(); }
Â  Â  Â  Â  function stopGeometric() { if (!geometricAnimationId) return; cancelAnimationFrame(geometricAnimationId); geometricAnimationId = null; if (geometricCanvas) geometricCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupFire() { if (!fireCanvas) return; fireCanvas.width = window.innerWidth; fireCanvas.height = window.innerHeight; fireCtx = fireCanvas.getContext('2d'); particles = []; for (let i = 0; i < 100; i++) { particles.push({ x: Math.random() * fireCanvas.width, y: fireCanvas.height, size: Math.random() * 5 + 1, speedY: Math.random() * 3 + 1, color: `hsl(${Math.random() * 30 + 30}, 100%, 50%)` }); } }
Â  Â  Â  Â  function animateFire() { if (!fireCtx) return; fireCtx.globalCompositeOperation = 'source-over'; fireCtx.fillStyle = 'rgba(0,0,0,0.1)'; fireCtx.fillRect(0, 0, fireCanvas.width, fireCanvas.height); fireCtx.globalCompositeOperation = 'lighter'; particles.forEach(p => { p.y -= p.speedY; p.x += (Math.random() - 0.5); if (p.y < 0) { p.x = Math.random() * fireCanvas.width; p.y = fireCanvas.height; } fireCtx.beginPath(); fireCtx.fillStyle = p.color; fireCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2); fireCtx.fill(); }); fireAnimationId = requestAnimationFrame(animateFire); }
Â  Â  Â  Â  function startFire() { if (fireAnimationId) return; if (!fireCanvas) return; fireCanvas.style.display = 'block'; setupFire(); animateFire(); }
Â  Â  Â  Â  function stopFire() { if (!fireAnimationId) return; cancelAnimationFrame(fireAnimationId); fireAnimationId = null; if (fireCanvas) fireCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupRain() { if (!rainCanvas) return; rainCanvas.width = window.innerWidth; rainCanvas.height = window.innerHeight; rainCtx = rainCanvas.getContext('2d'); raindrops = []; for (let i = 0; i < 500; i++) { raindrops.push({ x: Math.random() * rainCanvas.width, y: Math.random() * rainCanvas.height, length: Math.random() * 20 + 10, speed: Math.random() * 5 + 2 }); } }
Â  Â  Â  Â  function animateRain() { if (!rainCtx) return; rainCtx.fillStyle = 'rgba(0, 20, 40, 0.2)'; rainCtx.fillRect(0, 0, rainCanvas.width, rainCanvas.height); rainCtx.strokeStyle = 'rgba(174,194,224,0.5)'; rainCtx.lineWidth = 1; raindrops.forEach(drop => { drop.y += drop.speed; if (drop.y > rainCanvas.height) { drop.y = 0 - drop.length; drop.x = Math.random() * rainCanvas.width; } rainCtx.beginPath(); rainCtx.moveTo(drop.x, drop.y); rainCtx.lineTo(drop.x, drop.y + drop.length); rainCtx.stroke(); }); rainAnimationId = requestAnimationFrame(animateRain); }
Â  Â  Â  Â  function startRain() { if (rainAnimationId) return; if (!rainCanvas) return; rainCanvas.style.display = 'block'; setupRain(); animateRain(); }
Â  Â  Â  Â  function stopRain() { if (!rainAnimationId) return; cancelAnimationFrame(rainAnimationId); rainAnimationId = null; if (rainCanvas) rainCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupHyperspace() { if (!hyperspaceCanvas) return; hyperspaceCanvas.width = window.innerWidth; hyperspaceCanvas.height = window.innerHeight; hyperspaceCtx = hyperspaceCanvas.getContext('2d'); hyperStars = []; for (let i = 0; i < 500; i++) { hyperStars.push({ x: Math.random() * hyperspaceCanvas.width, y: Math.random() * hyperspaceCanvas.height, z: Math.random() * hyperspaceCanvas.width }); } }
Â  Â  Â  Â  function animateHyperspace() { if (!hyperspaceCtx) return; const w = hyperspaceCanvas.width; const h = hyperspaceCanvas.height; const halfW = w / 2; const halfH = h / 2; hyperspaceCtx.fillStyle = 'rgba(0, 0, 0, 0.2)'; hyperspaceCtx.fillRect(0, 0, w, h); hyperStars.forEach(star => { star.z -= 4; if (star.z <= 0) { star.z = w; } const k = 128.0 / star.z; const px = (star.x - halfW) * k + halfW; const py = (star.y - halfH) * k + halfH; if (px >= 0 && px < w && py >= 0 && py < h) { const size = (1 - star.z / w) * 5; const shade = (1 - star.z / w) * 255; hyperspaceCtx.fillStyle = `rgb(${shade}, ${shade}, ${shade})`; hyperspaceCtx.fillRect(px, py, size, size); } }); hyperspaceAnimationId = requestAnimationFrame(animateHyperspace); }
Â  Â  Â  Â  function startHyperspace() { if (hyperspaceAnimationId) return; if (!hyperspaceCanvas) return; hyperspaceCanvas.style.display = 'block'; setupHyperspace(); animateHyperspace(); }
Â  Â  Â  Â  function stopHyperspace() { if (!hyperspaceAnimationId) return; cancelAnimationFrame(hyperspaceAnimationId); hyperspaceAnimationId = null; if (hyperspaceCanvas) hyperspaceCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupPlasma() { if (!plasmaCanvas) return; plasmaCanvas.width = 128; plasmaCanvas.height = 128; plasmaCtx = plasmaCanvas.getContext('2d'); plasmaTime = 0; }
Â  Â  Â  Â  function animatePlasma() { if (!plasmaCtx) return; const w = plasmaCanvas.width; const h = plasmaCanvas.height; const imgData = plasmaCtx.createImageData(w, h); const data = imgData.data; plasmaTime += 0.05; for (let x = 0; x < w; x++) { for (let y = 0; y < h; y++) { const i = (x + y * w) * 4; const v = Math.sin(x / 8 + plasmaTime) + Math.sin(y / 4 + plasmaTime) + Math.sin((x + y) / 8 + plasmaTime) + Math.sin(Math.sqrt(x * x + y * y) / 4 + plasmaTime); data[i] = Math.sin(v * Math.PI) * 128 + 127; data[i+1] = Math.sin(v * Math.PI + 2 * Math.PI / 3) * 128 + 127; data[i+2] = Math.sin(v * Math.PI + 4 * Math.PI / 3) * 128 + 127; data[i+3] = 255; } } plasmaCtx.putImageData(imgData, 0, 0); plasmaAnimationId = requestAnimationFrame(animatePlasma); }
Â  Â  Â  Â  function startPlasma() { if (plasmaAnimationId) return; if (!plasmaCanvas) return; plasmaCanvas.style.display = 'block'; setupPlasma(); animatePlasma(); }
Â  Â  Â  Â  function stopPlasma() { if (!plasmaAnimationId) return; cancelAnimationFrame(plasmaAnimationId); plasmaAnimationId = null; if (plasmaCanvas) plasmaCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupForest() { if (!forestCanvas) return; forestCanvas.width = window.innerWidth; forestCanvas.height = window.innerHeight; forestCtx = forestCanvas.getContext('2d'); leaves = []; for (let i = 0; i < 50; i++) { leaves.push({ x: Math.random() * forestCanvas.width, y: Math.random() * forestCanvas.height, size: Math.random() * 5 + 3, speed: Math.random() + 0.5, angle: Math.random() * Math.PI * 2 }); } }
Â  Â  Â  Â  function animateForest() { if (!forestCtx) return; const w = forestCanvas.width; const h = forestCanvas.height; const gradient = forestCtx.createLinearGradient(0, 0, 0, h); gradient.addColorStop(0, '#2a4a2a'); gradient.addColorStop(1, '#0a1a0a'); forestCtx.fillStyle = gradient; forestCtx.fillRect(0, 0, w, h); leaves.forEach(leaf => { leaf.y += leaf.speed; leaf.x += Math.sin(leaf.angle + leaf.y / 20); if (leaf.y > h) { leaf.y = -leaf.size; leaf.x = Math.random() * w; } forestCtx.fillStyle = 'rgba(255, 223, 186, 0.7)'; forestCtx.beginPath(); forestCtx.arc(leaf.x, leaf.y, leaf.size, 0, Math.PI * 2); forestCtx.fill(); }); forestAnimationId = requestAnimationFrame(animateForest); }
Â  Â  Â  Â  function startForest() { if (forestAnimationId) return; if (!forestCanvas) return; forestCanvas.style.display = 'block'; setupForest(); animateForest(); }
Â  Â  Â  Â  function stopForest() { if (!forestAnimationId) return; cancelAnimationFrame(forestAnimationId); forestAnimationId = null; if (forestCanvas) forestCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupNeonGrid() { if (!neongridCanvas) return; neongridCanvas.width = window.innerWidth; neongridCanvas.height = window.innerHeight; neongridCtx = neongridCanvas.getContext('2d'); }
Â  Â  Â  Â  function animateNeonGrid() { if (!neongridCtx) return; const w = neongridCanvas.width; const h = neongridCanvas.height; const time = Date.now() * 0.0002; neongridCtx.fillStyle = '#000'; neongridCtx.fillRect(0, 0, w, h); const gridSize = 50; for (let i = 0; i < w / gridSize + 1; i++) { for (let j = 0; j < h / gridSize + 1; j++) { const x = i * gridSize; const y = j * gridSize; const dx = x - w / 2; const dy = y - h / 2; const dist = Math.sqrt(dx * dx + dy * dy); const pulse = Math.sin(dist * 0.05 - time * 5) * 0.5 + 0.5; neongridCtx.strokeStyle = `rgba(0, 255, 255, ${0.2 + pulse * 0.5})`; neongridCtx.lineWidth = 1 + pulse; neongridCtx.strokeRect(x - 1, y - 1, 2, 2); } } neongridAnimationId = requestAnimationFrame(animateNeonGrid); }
Â  Â  Â  Â  function startNeonGrid() { if (neongridAnimationId) return; if (!neongridCanvas) return; neongridCanvas.style.display = 'block'; setupNeonGrid(); animateNeonGrid(); }
Â  Â  Â  Â  function stopNeonGrid() { if (!neongridAnimationId) return; cancelAnimationFrame(neongridAnimationId); neongridAnimationId = null; if (neongridCanvas) neongridCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupSakura() { if (!sakuraCanvas) return; sakuraCanvas.width = window.innerWidth; sakuraCanvas.height = window.innerHeight; sakuraCtx = sakuraCanvas.getContext('2d'); sakuraPetals = []; for (let i = 0; i < 50; i++) { sakuraPetals.push({ x: Math.random() * sakuraCanvas.width, y: Math.random() * sakuraCanvas.height, size: Math.random() * 3 + 2, speed: Math.random() * 1 + 0.5, angle: Math.random() * 360 }); } }
Â  Â  Â  Â  function animateSakura() { if (!sakuraCtx) return; const w = sakuraCanvas.width; const h = sakuraCanvas.height; sakuraCtx.fillStyle = 'rgba(255, 230, 240, 0.1)'; sakuraCtx.fillRect(0, 0, w, h); sakuraCtx.fillStyle = '#FFC0CB'; sakuraPetals.forEach(p => { p.y += p.speed; p.x += Math.sin(p.angle); p.angle += 0.01; if (p.y > h) { p.y = -p.size; p.x = Math.random() * w; } sakuraCtx.save(); sakuraCtx.translate(p.x, p.y); sakuraCtx.rotate(p.angle); sakuraCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size); sakuraCtx.restore(); }); sakuraAnimationId = requestAnimationFrame(animateSakura); }
Â  Â  Â  Â  function startSakura() { if (sakuraAnimationId) return; if (!sakuraCanvas) return; sakuraCanvas.style.display = 'block'; setupSakura(); animateSakura(); }
Â  Â  Â  Â  function stopSakura() { if (!sakuraAnimationId) return; cancelAnimationFrame(sakuraAnimationId); sakuraAnimationId = null; if (sakuraCanvas) sakuraCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupQuantum() { if (!quantumCanvas) return; quantumCanvas.width = window.innerWidth; quantumCanvas.height = window.innerHeight; quantumCtx = quantumCanvas.getContext('2d'); quantumParticles = []; for (let i = 0; i < 200; i++) { quantumParticles.push({ x: Math.random() * quantumCanvas.width, y: Math.random() * quantumCanvas.height, size: Math.random() * 2, vx: (Math.random() - 0.5) * 0.5, vy: (Math.random() - 0.5) * 0.5 }); } }
Â  Â  Â  Â  function animateQuantum() { if (!quantumCtx) return; const w = quantumCanvas.width; const h = quantumCanvas.height; quantumCtx.fillStyle = 'rgba(10, 10, 20, 0.1)'; quantumCtx.fillRect(0, 0, w, h); quantumCtx.fillStyle = '#aaa'; quantumParticles.forEach(p => { p.x += p.vx; p.y += p.vy; if (p.x < 0 || p.x > w) p.vx *= -1; if (p.y < 0 || p.y > h) p.vy *= -1; quantumCtx.fillRect(p.x, p.y, p.size, p.size); }); quantumAnimationId = requestAnimationFrame(animateQuantum); }
Â  Â  Â  Â  function startQuantum() { if (quantumAnimationId) return; if (!quantumCanvas) return; quantumCanvas.style.display = 'block'; setupQuantum(); animateQuantum(); }
Â  Â  Â  Â  function stopQuantum() { if (!quantumAnimationId) return; cancelAnimationFrame(quantumAnimationId); quantumAnimationId = null; if (quantumCanvas) quantumCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupDigitalRain() { if (!digitalrainCanvas) return; digitalrainCanvas.width = window.innerWidth; digitalrainCanvas.height = window.innerHeight; digitalrainCtx = digitalrainCanvas.getContext('2d'); const columns = digitalrainCanvas.width / 20; digitalDrops = []; for (let x = 0; x < columns; x++) { digitalDrops[x] = 1; } }
Â  Â  Â  Â  function animateDigitalRain() { if (!digitalrainCtx) return; digitalrainCtx.fillStyle = 'rgba(0, 0, 0, 0.05)'; digitalrainCtx.fillRect(0, 0, digitalrainCanvas.width, digitalrainCanvas.height); digitalrainCtx.fillStyle = '#0FF'; digitalrainCtx.font = '15px monospace'; const chars = SUITS.concat(VALUES); for (let i = 0; i < digitalDrops.length; i++) { const text = chars[Math.floor(Math.random() * chars.length)]; digitalrainCtx.fillText(text, i * 20, digitalDrops[i] * 20); if (digitalDrops[i] * 20 > digitalrainCanvas.height && Math.random() > 0.975) { digitalDrops[i] = 0; } digitalDrops[i]++; } digitalrainAnimationId = requestAnimationFrame(animateDigitalRain); }
Â  Â  Â  Â  function startDigitalRain() { if (digitalrainAnimationId) return; if (!digitalrainCanvas) return; digitalrainCanvas.style.display = 'block'; setupDigitalRain(); animateDigitalRain(); }
Â  Â  Â  Â  function stopDigitalRain() { if (!digitalrainAnimationId) return; cancelAnimationFrame(digitalrainAnimationId); digitalrainAnimationId = null; if (digitalrainCanvas) digitalrainCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupSands() { if (!sandsCanvas) return; sandsCanvas.width = window.innerWidth; sandsCanvas.height = window.innerHeight; sandsCtx = sandsCanvas.getContext('2d'); sandTime = 0; }
Â  Â  Â  Â  function animateSands() { if (!sandsCtx) return; const w = sandsCanvas.width; const h = sandsCanvas.height; sandTime += 0.01; sandsCtx.clearRect(0, 0, w, h); for (let i = 0; i < 10; i++) { const color = `hsl(40, 50%, ${70 - i * 4}%)`; sandsCtx.fillStyle = color; sandsCtx.beginPath(); sandsCtx.moveTo(0, h); for (let x = 0; x < w; x++) { const y = h * 0.6 + Math.sin(x * 0.01 + sandTime + i * 0.5) * 20 * Math.sin(x * 0.001) + i * 20; sandsCtx.lineTo(x, y); } sandsCtx.lineTo(w, h); sandsCtx.fill(); } sandsAnimationId = requestAnimationFrame(animateSands); }
Â  Â  Â  Â  function startSands() { if (sandsAnimationId) return; if (!sandsCanvas) return; sandsCanvas.style.display = 'block'; setupSands(); animateSands(); }
Â  Â  Â  Â  function stopSands() { if (!sandsAnimationId) return; cancelAnimationFrame(sandsAnimationId); sandsAnimationId = null; if (sandsCanvas) sandsCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupInkBlot() { if (!inkblotCanvas) return; inkblotCanvas.width = window.innerWidth; inkblotCanvas.height = window.innerHeight; inkblotCtx = inkblotCanvas.getContext('2d'); inkblots = []; inkblotCtx.fillStyle = '#F5EEDC'; inkblotCtx.fillRect(0,0,inkblotCanvas.width, inkblotCanvas.height); const handler = (e) => { const rect = inkblotCanvas.getBoundingClientRect(); const x = (e.clientX || e.touches[0].clientX) - rect.left; const y = (e.clientY || e.touches[0].clientY) - rect.top; inkblots.push({ x, y, radius: 0, maxRadius: Math.random() * 50 + 20, speed: Math.random() * 0.5 + 0.2 }); }; inkblotCanvas.addEventListener('mousedown', handler); inkblotCanvas.addEventListener('touchstart', handler); }
Â  Â  Â  Â  function animateInkBlot() { if (!inkblotCtx) return; inkblotCtx.fillStyle = 'rgba(0,0,0,0.5)'; inkblots.forEach(blot => { if(blot.radius < blot.maxRadius) { blot.radius += blot.speed; } inkblotCtx.beginPath(); inkblotCtx.arc(blot.x, blot.y, blot.radius, 0, Math.PI * 2); inkblotCtx.fill(); }); inkblotAnimationId = requestAnimationFrame(animateInkBlot); }
Â  Â  Â  Â  function startInkBlot() { if(inkblotAnimationId) return; if(!inkblotCanvas) return; inkblotCanvas.style.display = 'block'; setupInkBlot(); animateInkBlot(); }
Â  Â  Â  Â  function stopInkBlot() { if(!inkblotAnimationId) return; cancelAnimationFrame(inkblotAnimationId); inkblotAnimationId = null; if(inkblotCanvas) inkblotCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupCosmic() { if (!cosmicCanvas) return; cosmicCanvas.width = window.innerWidth; cosmicCanvas.height = window.innerHeight; cosmicCtx = cosmicCanvas.getContext('2d'); cosmicStars = Array.from({length: 500}, () => ({x: Math.random(), y: Math.random(), z: Math.random()})); cosmicRipples = []; const handler = (e) => { const rect = cosmicCanvas.getBoundingClientRect(); const x = (e.clientX || e.touches[0].clientX) - rect.left; const y = (e.clientY || e.touches[0].clientY) - rect.top; cosmicRipples.push({x, y, radius: 0, maxRadius: 200, speed: 2}); }; cosmicCanvas.addEventListener('mousedown', handler); cosmicCanvas.addEventListener('touchstart', handler); }
Â  Â  Â  Â  function animateCosmic() { if (!cosmicCtx) return; const w = cosmicCanvas.width; const h = cosmicCanvas.height; cosmicCtx.fillStyle = 'black'; cosmicCtx.fillRect(0,0,w,h); cosmicRipples.forEach((r, i) => { r.radius += r.speed; if(r.radius > r.maxRadius) cosmicRipples.splice(i, 1); }); cosmicCtx.fillStyle = 'white'; cosmicStars.forEach(s => { let sx = s.x * w; let sy = s.y * h; cosmicRipples.forEach(r => { const dx = sx-r.x; const dy = sy-r.y; const dist = Math.sqrt(dx*dx + dy*dy); if(dist < r.radius) { const angle = Math.atan2(dy, dx); const warp = (1 - dist/r.radius) * 20; sx += Math.cos(angle) * warp; sy += Math.sin(angle) * warp; } }); const size = s.z * 2; cosmicCtx.fillRect(sx, sy, size, size); }); cosmicAnimationId = requestAnimationFrame(animateCosmic); }
Â  Â  Â  Â  function startCosmic() { if(cosmicAnimationId) return; if(!cosmicCanvas) return; cosmicCanvas.style.display = 'block'; setupCosmic(); animateCosmic(); }
Â  Â  Â  Â  function stopCosmic() { if(!cosmicAnimationId) return; cancelAnimationFrame(cosmicAnimationId); cosmicAnimationId = null; if(cosmicCanvas) cosmicCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupMusicViz() { if (!musicvizCanvas) return; musicvizCanvas.width = window.innerWidth; musicvizCanvas.height = window.innerHeight; musicvizCtx = musicvizCanvas.getContext('2d'); }
Â  Â  Â  Â  function animateMusicViz() { if (!musicvizCtx || !analyser) return; const w = musicvizCanvas.width; const h = musicvizCanvas.height; musicvizCtx.fillStyle = 'rgba(0,0,10,0.1)'; musicvizCtx.fillRect(0,0,w,h); const values = analyser.getValue(); const barWidth = w / values.length; for(let i=0; i<values.length; i++) { const val = (values[i] + 140) * 2; const hue = i / values.length * 360; musicvizCtx.fillStyle = `hsla(${hue}, 100%, 50%, 0.5)`; musicvizCtx.fillRect(i*barWidth, h-val, barWidth, val); } musicvizAnimationId = requestAnimationFrame(animateMusicViz); }
Â  Â  Â  Â  function startMusicViz() { if(musicvizAnimationId) return; if(!musicvizCanvas) return; musicvizCanvas.style.display = 'block'; setupMusicViz(); animateMusicViz(); }
Â  Â  Â  Â  function stopMusicViz() { if(!musicvizAnimationId) return; cancelAnimationFrame(musicvizAnimationId); musicvizAnimationId = null; if(musicvizCanvas) musicvizCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupBioForest() { if (!bioforestCanvas) return; bioforestCanvas.width = window.innerWidth; bioforestCanvas.height = window.innerHeight; bioforestCtx = bioforestCanvas.getContext('2d'); bioPlants = Array.from({length: 100}, () => ({x: Math.random() * bioforestCanvas.width, y: Math.random() * bioforestCanvas.height, size: Math.random() * 10 + 5, brightness: 0.1, hue: Math.random()*60 + 100})); const handler = (e) => { const rect = bioforestCanvas.getBoundingClientRect(); mousePos.x = (e.clientX || e.touches[0].clientX) - rect.left; mousePos.y = (e.clientY || e.touches[0].clientY) - rect.top; }; bioforestCanvas.addEventListener('mousemove', handler); bioforestCanvas.addEventListener('touchmove', handler); }
Â  Â  Â  Â  function animateBioForest() { if (!bioforestCtx) return; const w = bioforestCanvas.width; const h = bioforestCanvas.height; bioforestCtx.fillStyle = '#0a1a0a'; bioforestCtx.fillRect(0,0,w,h); bioPlants.forEach(p => { const dx = p.x - mousePos.x; const dy = p.y - mousePos.y; const dist = Math.sqrt(dx*dx + dy*dy); p.brightness = Math.max(0.1, 1 - dist/100); bioforestCtx.fillStyle = `hsla(${p.hue}, 80%, 50%, ${p.brightness})`; bioforestCtx.beginPath(); bioforestCtx.arc(p.x, p.y, p.size, 0, Math.PI*2); bioforestCtx.fill(); }); bioforestAnimationId = requestAnimationFrame(animateBioForest); }
Â  Â  Â  Â  function startBioForest() { if(bioforestAnimationId) return; if(!bioforestCanvas) return; bioforestCanvas.style.display = 'block'; setupBioForest(); animateBioForest(); }
Â  Â  Â  Â  function stopBioForest() { if(!bioforestAnimationId) return; cancelAnimationFrame(bioforestAnimationId); bioforestAnimationId = null; if(bioforestCanvas) bioforestCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupWatery() { if (!wateryCanvas) return; wateryCanvas.width = window.innerWidth/4; wateryCanvas.height = window.innerHeight/4; wateryCtx = wateryCanvas.getContext('2d'); wateryRipples = []; const handler = (e) => { const rect = wateryCanvas.getBoundingClientRect(); const x = ((e.clientX || e.touches[0].clientX) - rect.left) / 4; const y = ((e.clientY || e.touches[0].clientY) - rect.top) / 4; wateryRipples.push({x, y, radius: 0, maxRadius: 50, speed: 1}); }; wateryCanvas.addEventListener('mousedown', handler); wateryCanvas.addEventListener('touchstart', handler); }
Â  Â  Â  Â  function animateWatery() { if (!wateryCtx) return; const w = wateryCanvas.width; const h = wateryCanvas.height; wateryCtx.fillStyle = '#3498db'; wateryCtx.fillRect(0,0,w,h); wateryRipples.forEach((r,i) => { r.radius += r.speed; if(r.radius > r.maxRadius) wateryRipples.splice(i,1); wateryCtx.strokeStyle = `rgba(255,255,255, ${1 - r.radius/r.maxRadius})`; wateryCtx.lineWidth = 2; wateryCtx.beginPath(); wateryCtx.arc(r.x, r.y, r.radius, 0, Math.PI*2); wateryCtx.stroke(); }); wateryAnimationId = requestAnimationFrame(animateWatery); }
Â  Â  Â  Â  function startWatery() { if(wateryAnimationId) return; if(!wateryCanvas) return; wateryCanvas.style.display = 'block'; setupWatery(); animateWatery(); }
Â  Â  Â  Â  function stopWatery() { if(!wateryAnimationId) return; cancelAnimationFrame(wateryAnimationId); wateryAnimationId = null; if(wateryCanvas) wateryCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupStainedGlass() { if (!stainedglassCanvas) return; stainedglassCanvas.width = window.innerWidth; stainedglassCanvas.height = window.innerHeight; stainedglassCtx = stainedglassCanvas.getContext('2d'); glassPanes = []; const cols = 20; const rows = 15; const paneWidth = stainedglassCanvas.width / cols; const paneHeight = stainedglassCanvas.height / rows; for (let i = 0; i < cols; i++) { for (let j = 0; j < rows; j++) { glassPanes.push({ x: i * paneWidth, y: j * paneHeight, width: paneWidth, height: paneHeight, hue: Math.random() * 360, brightness: 0.2 }); } } }
Â  Â  Â  Â  function animateStainedGlass() { if (!stainedglassCtx) return; const w = stainedglassCanvas.width; const h = stainedglassCanvas.height; stainedglassCtx.fillStyle = 'black'; stainedglassCtx.fillRect(0, 0, w, h); glassPanes.forEach(p => { const dx = (p.x + p.width / 2) - mousePos.x; const dy = (p.y + p.height / 2) - mousePos.y; const dist = Math.sqrt(dx * dx + dy * dy); p.brightness = Math.max(0.2, 1 - dist / 300); stainedglassCtx.fillStyle = `hsl(${p.hue}, 80%, ${p.brightness * 50}%)`; stainedglassCtx.fillRect(p.x, p.y, p.width, p.height); stainedglassCtx.strokeStyle = 'black'; stainedglassCtx.lineWidth = 4; stainedglassCtx.strokeRect(p.x, p.y, p.width, p.height); }); stainedglassAnimationId = requestAnimationFrame(animateStainedGlass); }
Â  Â  Â  Â  function startStainedGlass() { if (stainedglassAnimationId) return; if (!stainedglassCanvas) return; stainedglassCanvas.style.display = 'block'; setupStainedGlass(); animateStainedGlass(); }
Â  Â  Â  Â  function stopStainedGlass() { if (!stainedglassAnimationId) return; cancelAnimationFrame(stainedglassAnimationId); stainedglassAnimationId = null; if (stainedglassCanvas) stainedglassCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupSwarm() { if (!swarmCanvas) return; swarmCanvas.width = window.innerWidth; swarmCanvas.height = window.innerHeight; swarmCtx = swarmCanvas.getContext('2d'); swarmParticles = []; for (let i = 0; i < 200; i++) { swarmParticles.push({ x: Math.random() * swarmCanvas.width, y: Math.random() * swarmCanvas.height, size: Math.random() * 2 + 1, vx: 0, vy: 0 }); } }
Â  Â  Â  Â  function animateSwarm() { if (!swarmCtx) return; const w = swarmCanvas.width; const h = swarmCanvas.height; swarmCtx.fillStyle = 'rgba(0,0,0,0.2)'; swarmCtx.fillRect(0, 0, w, h); swarmParticles.forEach(p => { const dx = p.x - mousePos.x; const dy = p.y - mousePos.y; const dist = Math.sqrt(dx * dx + dy * dy); const maxDist = 100; if (dist < maxDist) { const force = (maxDist - dist) / maxDist; p.vx += (dx / dist) * force * 0.5; p.vy += (dy / dist) * force * 0.5; } p.vx *= 0.95; p.vy *= 0.95; p.vx += (Math.random() - 0.5) * 0.1; p.vy += (Math.random() - 0.5) * 0.1; p.x += p.vx; p.y += p.vy; if (p.x > w || p.x < 0) p.vx *= -1; if (p.y > h || p.y < 0) p.vy *= -1; swarmCtx.fillStyle = 'white'; swarmCtx.fillRect(p.x, p.y, p.size, p.size); }); swarmAnimationId = requestAnimationFrame(animateSwarm); }
Â  Â  Â  Â  function startSwarm() { if (swarmAnimationId) return; if (!swarmCanvas) return; swarmCanvas.style.display = 'block'; setupSwarm(); animateSwarm(); }
Â  Â  Â  Â  function stopSwarm() { if (!swarmAnimationId) return; cancelAnimationFrame(swarmAnimationId); swarmAnimationId = null; if (swarmCanvas) swarmCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupGlitch() { if (!glitchCanvas) return; glitchCanvas.width = window.innerWidth; glitchCanvas.height = window.innerHeight; glitchCtx = glitchCanvas.getContext('2d'); glitchCtx.fillStyle = 'black'; glitchCtx.fillRect(0,0,glitchCanvas.width, glitchCanvas.height); glitchCtx.font = "bold 15vw 'Courier New'"; glitchCtx.textAlign = 'center'; glitchCtx.textBaseline = 'middle'; glitchCtx.fillStyle = '#0f0'; glitchCtx.fillText('SOLITAIRE', glitchCanvas.width/2, glitchCanvas.height/2); glitchData = glitchCtx.getImageData(0,0,glitchCanvas.width, glitchCanvas.height); }
Â  Â  Â  Â  function animateGlitch() { if (!glitchCtx) return; const w = glitchCanvas.width; const h = glitchCanvas.height; if (Math.random() > 0.9) { const tempImgData = new ImageData(new Uint8ClampedArray(glitchData.data), w, h); const data = tempImgData.data; const glitchAmount = Math.floor(mousePos.x / w * 50); for (let i = 0; i < 10; i++) { const y = Math.floor(Math.random() * h); const rowOffset = (Math.floor(Math.random() * glitchAmount) - glitchAmount / 2) * 4; const row = tempImgData.data.slice(y * w * 4, (y + 1) * w * 4); for (let x = 0; x < w * 4; x++) { data[y * w * 4 + x] = row[(x + rowOffset + w * 4) % (w * 4)]; } } glitchCtx.putImageData(tempImgData, 0, 0); } glitchAnimationId = requestAnimationFrame(animateGlitch); }
Â  Â  Â  Â  function startGlitch() { if (glitchAnimationId) return; if (!glitchCanvas) return; glitchCanvas.style.display = 'block'; setupGlitch(); animateGlitch(); }
Â  Â  Â  Â  function stopGlitch() { if (!glitchAnimationId) return; cancelAnimationFrame(glitchAnimationId); glitchAnimationId = null; if (glitchCanvas) glitchCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupAurora() { if (!auroraCanvas) return; auroraCanvas.width = window.innerWidth; auroraCanvas.height = window.innerHeight; auroraCtx = auroraCanvas.getContext('2d'); auroraParticles = []; for (let i = 0; i < 3; i++) { for (let j = 0; j < 50; j++) { auroraParticles.push({ x: Math.random() * auroraCanvas.width, y: Math.random() * auroraCanvas.height, vx: 0, vy: 0, hue: 120 + i * 40, life: Math.random() * 100 }); } } }
Â  Â  Â  Â  function animateAurora() { if (!auroraCtx) return; const w = auroraCanvas.width; const h = auroraCanvas.height; auroraCtx.globalCompositeOperation = 'source-over'; auroraCtx.fillStyle = 'rgba(0,0,10,0.1)'; auroraCtx.fillRect(0,0,w,h); auroraCtx.globalCompositeOperation = 'lighter'; auroraParticles.forEach(p => { const dx = p.x - mousePos.x; const dy = p.y - mousePos.y; const dist = Math.sqrt(dx*dx + dy*dy); const angle = Math.sin(p.x / 100) + Math.sin(p.y / 100) + Date.now() * 0.0001; p.vx += Math.cos(angle) * 0.1; p.vy += Math.sin(angle) * 0.1; if (dist < 150) { p.vx += (dx / dist) * (1 - dist / 150) * 0.5; p.vy += (dy / dist) * (1 - dist / 150) * 0.5; } p.vx *= 0.98; p.vy *= 0.98; p.x += p.vx; p.y += p.vy; p.life--; if (p.life <= 0 || p.x < 0 || p.x > w || p.y < 0 || p.y > h) { p.x = Math.random() * w; p.y = Math.random() * h; p.vx = 0; p.vy = 0; p.life = 100; } auroraCtx.fillStyle = `hsla(${p.hue}, 100%, 50%, ${p.life/100 * 0.1})`; auroraCtx.beginPath(); auroraCtx.arc(p.x, p.y, 2, 0, Math.PI*2); auroraCtx.fill(); }); auroraAnimationId = requestAnimationFrame(animateAurora); }
Â  Â  Â  Â  function startAurora() { if (auroraAnimationId) return; if (!auroraCanvas) return; auroraCanvas.style.display = 'block'; setupAurora(); animateAurora(); }
Â  Â  Â  Â  function stopAurora() { if (!auroraAnimationId) return; cancelAnimationFrame(auroraAnimationId); auroraAnimationId = null; if (auroraCanvas) auroraCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupConstellation() { if (!constellationCanvas) return; constellationCanvas.width = window.innerWidth; constellationCanvas.height = window.innerHeight; constellationCtx = constellationCanvas.getContext('2d'); constellationStars = []; for (let i = 0; i < 200; i++) { constellationStars.push({ x: Math.random() * constellationCanvas.width, y: Math.random() * constellationCanvas.height, size: Math.random() * 2 + 1 }); } }
Â  Â  Â  Â  function animateConstellation() { if (!constellationCtx) return; const w = constellationCanvas.width; const h = constellationCanvas.height; constellationCtx.fillStyle = 'black'; constellationCtx.fillRect(0,0,w,h); constellationStars.forEach(s1 => { const dx = s1.x - mousePos.x; const dy = s1.y - mousePos.y; const dist = Math.sqrt(dx*dx + dy*dy); const brightness = Math.max(0.2, 1 - dist / 200); constellationCtx.fillStyle = `rgba(255,255,255, ${brightness})`; constellationCtx.beginPath(); constellationCtx.arc(s1.x, s1.y, s1.size * brightness, 0, Math.PI*2); constellationCtx.fill(); constellationStars.forEach(s2 => { if (s1 === s2) return; const lineDist = Math.sqrt(Math.pow(s1.x - s2.x, 2) + Math.pow(s1.y - s2.y, 2)); if (lineDist < 100) { const lineOpacity = 1 - lineDist / 100; constellationCtx.strokeStyle = `rgba(255,255,255, ${lineOpacity * brightness * 0.5})`; constellationCtx.lineWidth = 0.5; constellationCtx.beginPath(); constellationCtx.moveTo(s1.x, s1.y); constellationCtx.lineTo(s2.x, s2.y); constellationCtx.stroke(); } }); }); constellationAnimationId = requestAnimationFrame(animateConstellation); }
Â  Â  Â  Â  function startConstellation() { if (constellationAnimationId) return; if (!constellationCanvas) return; constellationCanvas.style.display = 'block'; setupConstellation(); animateConstellation(); }
Â  Â  Â  Â  function stopConstellation() { if (!constellationAnimationId) return; cancelAnimationFrame(constellationAnimationId); constellationAnimationId = null; if (constellationCanvas) constellationCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupSynthwave() { if (!synthwaveCanvas) return; synthwaveCanvas.width = window.innerWidth; synthwaveCanvas.height = window.innerHeight; synthwaveCtx = synthwaveCanvas.getContext('2d'); synthwaveTime = 0; }
Â  Â  Â  Â  function animateSynthwave() { if (!synthwaveCtx) return; const w = synthwaveCanvas.width; const h = synthwaveCanvas.height; synthwaveTime += 0.01; synthwaveCtx.fillStyle = '#21003c'; synthwaveCtx.fillRect(0, 0, w, h); const sunGradient = synthwaveCtx.createRadialGradient(w / 2, h / 2, 50, w / 2, h / 2, 200); sunGradient.addColorStop(0, '#ffcc00'); sunGradient.addColorStop(1, 'rgba(255, 100, 0, 0)'); synthwaveCtx.fillStyle = sunGradient; synthwaveCtx.fillRect(0, 0, w, h); synthwaveCtx.strokeStyle = '#ff00ff'; synthwaveCtx.lineWidth = 2; for (let i = 0; i < 20; i++) { const y = h / 2 + i * i; const p = (y - h / 2) / (h / 2); synthwaveCtx.beginPath(); synthwaveCtx.moveTo(0, y); synthwaveCtx.lineTo(w, y); synthwaveCtx.stroke(); } for (let i = -20; i < 20; i++) { synthwaveCtx.beginPath(); synthwaveCtx.moveTo(w / 2, h / 2); synthwaveCtx.lineTo(w / 2 + Math.tan(p * 1.4 - 0.7) * w, h); synthwaveCtx.stroke(); } synthwaveAnimationId = requestAnimationFrame(animateSynthwave); }
Â  Â  Â  Â  function startSynthwave() { if (synthwaveAnimationId) return; if (!synthwaveCanvas) return; synthwaveCanvas.style.display = 'block'; setupSynthwave(); animateSynthwave(); }
Â  Â  Â  Â  function stopSynthwave() { if (!synthwaveAnimationId) return; cancelAnimationFrame(synthwaveAnimationId); synthwaveAnimationId = null; if (synthwaveCanvas) synthwaveCanvas.style.display = 'none'; }
Â  Â  Â  Â  function setupNebula() { if (!nebulaCanvas) return; nebulaCanvas.width = window.innerWidth; nebulaCanvas.height = window.innerHeight; nebulaCtx = nebulaCanvas.getContext('2d'); nebulaParticles = []; for (let i = 0; i < 200; i++) { nebulaParticles.push({ x: Math.random() * nebulaCanvas.width, y: Math.random() * nebulaCanvas.height, size: Math.random() * 2, hue: Math.random() * 60 + 240 }); } }
Â  Â  Â  Â  function animateNebula() { if (!nebulaCtx) return; const w = nebulaCanvas.width; const h = nebulaCanvas.height; nebulaCtx.globalCompositeOperation = 'source-over'; nebulaCtx.fillStyle = 'rgba(0, 0, 10, 0.1)'; nebulaCtx.fillRect(0, 0, w, h); nebulaCtx.globalCompositeOperation = 'lighter'; nebulaParticles.forEach(p => { p.x += (Math.random() - 0.5); p.y += (Math.random() - 0.5); if (p.x < 0 || p.x > w || p.y < 0 || p.y > h) { p.x = Math.random() * w; p.y = Math.random() * h
